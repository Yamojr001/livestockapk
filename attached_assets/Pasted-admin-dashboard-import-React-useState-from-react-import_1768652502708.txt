admin dashboard


import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { createPageUrl } from '@/utils';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  BarChart3,
  Users,
  FileText,
  MapPin,
  TrendingUp,
  TrendingDown,
  ChevronRight,
  RefreshCw,
  Building2,
  Activity,
  Package,
  MessageSquare,
  CreditCard
} from 'lucide-react';
import { format, subDays, isWithinInterval } from 'date-fns';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell } from 'recharts';
import { getLGAs } from '@/components/data/lgaWardData';

export default function AdminDashboard() {
  const [dateRange, setDateRange] = useState('7');

  const { data: submissions = [], isLoading: submissionsLoading } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list('-created_date'),
  });

  const { data: users = [], isLoading: usersLoading } = useQuery({
    queryKey: ['allUsers'],
    queryFn: () => base44.entities.User.list(),
  });

  const agents = users.filter(u => u.user_role === 'agent');
  const activeAgents = agents.filter(u => u.status === 'active');

  // Calculate stats
  const today = new Date();
  const startDate = subDays(today, parseInt(dateRange));
  
  const recentSubmissions = submissions.filter(s => 
    s.created_date && isWithinInterval(new Date(s.created_date), { start: startDate, end: today })
  );

  const previousPeriodStart = subDays(startDate, parseInt(dateRange));
  const previousSubmissions = submissions.filter(s =>
    s.created_date && isWithinInterval(new Date(s.created_date), { start: previousPeriodStart, end: startDate })
  );

  const growthRate = previousSubmissions.length > 0 
    ? ((recentSubmissions.length - previousSubmissions.length) / previousSubmissions.length * 100).toFixed(1)
    : 0;

  // Group by LGA
  const byLGA = submissions.reduce((acc, sub) => {
    acc[sub.lga] = (acc[sub.lga] || 0) + 1;
    return acc;
  }, {});

  const lgaChartData = Object.entries(byLGA)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10)
    .map(([name, value]) => ({ name, value }));

  // Group by association
  const byAssociation = submissions.reduce((acc, sub) => {
    const short = sub.association?.split(' ').slice(0, 2).join(' ') || 'Other';
    acc[short] = (acc[short] || 0) + 1;
    return acc;
  }, {});

  const associationData = Object.entries(byAssociation)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 6)
    .map(([name, value]) => ({ name, value }));

  const COLORS = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];

  // Stats cards
  const stats = [
    {
      title: 'Total Submissions',
      value: submissions.length.toLocaleString(),
      icon: FileText,
      trend: growthRate > 0 ? `+${growthRate}%` : `${growthRate}%`,
      trendUp: growthRate > 0,
      color: 'emerald'
    },
    {
      title: 'Active Agents',
      value: `${activeAgents.length}/${agents.length}`,
      icon: Users,
      color: 'blue'
    },
    {
      title: 'LGAs Covered',
      value: Object.keys(byLGA).length,
      subtitle: `of 27`,
      icon: MapPin,
      color: 'purple'
    },
    {
      title: 'This Period',
      value: recentSubmissions.length.toLocaleString(),
      subtitle: `Last ${dateRange} days`,
      icon: Activity,
      color: 'amber'
    }
  ];

  if (submissionsLoading || usersLoading) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <RefreshCw className="w-8 h-8 animate-spin text-emerald-600" />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Admin Dashboard</h1>
          <p className="text-slate-500 mt-1">Overview of livestock data collection</p>
        </div>
        <Select value={dateRange} onValueChange={setDateRange}>
          <SelectTrigger className="w-40">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="7">Last 7 days</SelectItem>
            <SelectItem value="14">Last 14 days</SelectItem>
            <SelectItem value="30">Last 30 days</SelectItem>
            <SelectItem value="90">Last 90 days</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
        {stats.map((stat) => (
          <Card key={stat.title} className="hover:shadow-lg transition-shadow">
            <CardContent className="p-6">
              <div className="flex items-start justify-between">
                <div>
                  <p className="text-slate-500 text-sm">{stat.title}</p>
                  <div className="flex items-baseline gap-2 mt-1">
                    <p className="text-2xl font-bold text-slate-900">{stat.value}</p>
                    {stat.subtitle && (
                      <span className="text-slate-400 text-sm">{stat.subtitle}</span>
                    )}
                  </div>
                  {stat.trend && (
                    <div className={`flex items-center gap-1 mt-2 text-sm ${
                      stat.trendUp ? 'text-emerald-600' : 'text-red-500'
                    }`}>
                      {stat.trendUp ? (
                        <TrendingUp className="w-4 h-4" />
                      ) : (
                        <TrendingDown className="w-4 h-4" />
                      )}
                      {stat.trend}
                    </div>
                  )}
                </div>
                <div className={`w-12 h-12 rounded-xl bg-${stat.color}-100 flex items-center justify-center`}>
                  <stat.icon className={`w-6 h-6 text-${stat.color}-600`} />
                </div>
              </div>
            </CardContent>
          </Card>
        ))}
      </div>

      {/* Charts Row */}
      <div className="grid lg:grid-cols-2 gap-6">
        {/* By LGA Chart */}
        <Card>
          <CardHeader className="border-b border-slate-100">
            <CardTitle className="text-lg flex items-center gap-2">
              <BarChart3 className="w-5 h-5 text-emerald-600" />
              Submissions by LGA
            </CardTitle>
          </CardHeader>
          <CardContent className="p-6">
            <div className="h-72">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={lgaChartData} layout="vertical">
                  <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                  <XAxis type="number" tick={{ fontSize: 12 }} />
                  <YAxis 
                    type="category" 
                    dataKey="name" 
                    width={80} 
                    tick={{ fontSize: 11 }}
                  />
                  <Tooltip 
                    contentStyle={{ 
                      borderRadius: '8px', 
                      border: '1px solid #e2e8f0',
                      boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)'
                    }}
                  />
                  <Bar dataKey="value" fill="#10b981" radius={[0, 4, 4, 0]} />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </CardContent>
        </Card>

        {/* By Association Chart */}
        <Card>
          <CardHeader className="border-b border-slate-100">
            <CardTitle className="text-lg flex items-center gap-2">
              <Building2 className="w-5 h-5 text-emerald-600" />
              By Association
            </CardTitle>
          </CardHeader>
          <CardContent className="p-6">
            <div className="h-72 flex items-center">
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie
                    data={associationData}
                    cx="50%"
                    cy="50%"
                    innerRadius={60}
                    outerRadius={100}
                    paddingAngle={2}
                    dataKey="value"
                  >
                    {associationData.map((entry, index) => (
                      <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                    ))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
              <div className="space-y-2 ml-4">
                {associationData.map((item, index) => (
                  <div key={item.name} className="flex items-center gap-2 text-sm">
                    <div 
                      className="w-3 h-3 rounded-full" 
                      style={{ backgroundColor: COLORS[index % COLORS.length] }}
                    />
                    <span className="text-slate-600 truncate max-w-[100px]">{item.name}</span>
                  </div>
                ))}
              </div>
            </div>
          </CardContent>
        </Card>
      </div>

      {/* Admin Modules */}
      <div>
        <h2 className="text-xl font-bold text-slate-900 mb-4">Admin Modules</h2>
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          <Link to={createPageUrl('DataManagement')}>
            <Card className="hover:shadow-lg hover:border-emerald-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-emerald-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <FileText className="w-7 h-7 text-emerald-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">Data Management</h3>
                    <p className="text-slate-500 text-xs mt-1">View & export submissions</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('UserManagement')}>
            <Card className="hover:shadow-lg hover:border-blue-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-blue-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <Users className="w-7 h-7 text-blue-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">User Management</h3>
                    <p className="text-slate-500 text-xs mt-1">{users.length} total users</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('SystemConfig')}>
            <Card className="hover:shadow-lg hover:border-purple-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-purple-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <Activity className="w-7 h-7 text-purple-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">System Config</h3>
                    <p className="text-slate-500 text-xs mt-1">Form configurations</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('AgentManagement')}>
            <Card className="hover:shadow-lg hover:border-amber-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-amber-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <Users className="w-7 h-7 text-amber-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">Agent Management</h3>
                    <p className="text-slate-500 text-xs mt-1">{agents.length} active agents</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('AuditLogs')}>
            <Card className="hover:shadow-lg hover:border-rose-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-rose-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <Activity className="w-7 h-7 text-rose-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">Audit Logs</h3>
                    <p className="text-slate-500 text-xs mt-1">System activity logs</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('DistributionManagement')}>
            <Card className="hover:shadow-lg hover:border-green-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-green-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <Package className="w-7 h-7 text-green-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">Distribution</h3>
                    <p className="text-slate-500 text-xs mt-1">Resource allocation</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>

          <Link to={createPageUrl('BulkSMS')}>
            <Card className="hover:shadow-lg hover:border-indigo-200 transition-all cursor-pointer group h-full">
              <CardContent className="p-4 sm:p-6">
                <div className="flex flex-col items-center text-center gap-3">
                  <div className="w-14 h-14 rounded-xl bg-indigo-100 flex items-center justify-center group-hover:scale-110 transition-transform">
                    <MessageSquare className="w-7 h-7 text-indigo-600" />
                  </div>
                  <div>
                    <h3 className="font-semibold text-slate-900">Bulk SMS</h3>
                    <p className="text-slate-500 text-xs mt-1">Send notifications</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </Link>
        </div>
      </div>

      {/* Recent Submissions */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <div className="flex items-center justify-between">
            <CardTitle className="text-lg">Recent Submissions</CardTitle>
            <Link to={createPageUrl('DataManagement')}>
              <Button variant="ghost" size="sm" className="text-emerald-600">
                View All <ChevronRight className="w-4 h-4 ml-1" />
              </Button>
            </Link>
          </div>
        </CardHeader>
        <CardContent className="p-0">
          <div className="divide-y divide-slate-100">
            {submissions.slice(0, 5).map((sub) => (
              <div key={sub.id} className="p-4 hover:bg-slate-50 transition-colors">
                <div className="flex items-center justify-between">
                  <div>
                    <p className="font-medium text-slate-900">{sub.farmer_name}</p>
                    <p className="text-slate-500 text-sm">{sub.association}</p>
                  </div>
                  <div className="text-right">
                    <Badge variant="outline">{sub.lga}</Badge>
                    <p className="text-xs text-slate-400 mt-1">
                      {sub.created_date && format(new Date(sub.created_date), 'MMM d, h:mm a')}
                    </p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}


agentdashboard

import React, { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { createPageUrl } from '@/utils';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { motion } from 'framer-motion';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import {
  FileText,
  Cloud,
  CloudOff,
  RefreshCw,
  Clock,
  MapPin,
  Plus,
  ChevronRight,
  TrendingUp,
  CheckCircle2,
  AlertCircle,
  Wifi,
  WifiOff,
  HelpCircle
} from 'lucide-react';
import { format } from 'date-fns';

export default function AgentDashboard() {
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [pendingSync, setPendingSync] = useState(0);

  useEffect(() => {
    const handleOnline = () => {
      setIsOnline(true);
      // Auto-sync when coming back online
      const pending = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
      if (pending.length > 0) {
        handleSync();
      }
    };
    const handleOffline = () => setIsOnline(false);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    // Check localStorage for pending submissions
    const checkPending = () => {
      const pending = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
      setPendingSync(pending.length);
    };
    checkPending();
    
    // Periodically check for pending submissions
    const interval = setInterval(checkPending, 5000);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
      clearInterval(interval);
    };
  }, []);

  const { data: user, isLoading: userLoading } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: submissions = [], isLoading: submissionsLoading, refetch } = useQuery({
    queryKey: ['mySubmissions', user?.email],
    queryFn: () => base44.entities.LivestockSubmission.filter({ created_by: user?.email }, '-created_date'),
    enabled: !!user?.email,
  });

  const totalSubmissions = submissions.length;
  const syncedSubmissions = submissions.filter(s => s.submission_status === 'synced').length;
  const lastSync = user?.last_sync ? format(new Date(user.last_sync), 'PPp') : 'Never';

  const [isSyncing, setIsSyncing] = useState(false);
  const [syncSuccess, setSyncSuccess] = useState(false);

  const handleSync = async () => {
    const pending = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
    
    if (pending.length > 0 && isOnline) {
      setIsSyncing(true);
      setSyncSuccess(false);
      try {
        for (const submission of pending) {
          await base44.entities.LivestockSubmission.create({
            ...submission,
            submission_status: 'synced'
          });
        }
        localStorage.setItem('pendingSubmissions', '[]');
        setPendingSync(0);
        await base44.auth.updateMe({ last_sync: new Date().toISOString() });
        await refetch();
        setSyncSuccess(true);
        setTimeout(() => setSyncSuccess(false), 3000);
      } catch (error) {
        console.error('Sync failed:', error);
      } finally {
        setIsSyncing(false);
      }
    }
  };

  const stats = [
    {
      title: 'Total Submissions',
      value: totalSubmissions,
      icon: FileText,
      color: 'emerald',
      trend: '+12% this week'
    },
    {
      title: 'Synced Online',
      value: syncedSubmissions,
      icon: Cloud,
      color: 'blue',
    },
    {
      title: 'Pending Sync',
      value: pendingSync,
      icon: CloudOff,
      color: pendingSync > 0 ? 'amber' : 'slate',
    }
  ];

  if (userLoading) {
    return (
      <div className="flex items-center justify-center min-h-[60vh]">
        <RefreshCw className="w-8 h-8 animate-spin text-emerald-600" />
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">
            Welcome back, {user?.full_name?.split(' ')[0]}
          </h1>
          <p className="text-slate-500 mt-1">
            Here's your data collection overview
          </p>
        </div>
        <div className="flex items-center gap-3">
          <Badge 
            variant={isOnline ? 'default' : 'secondary'}
            className={`px-3 py-1.5 ${isOnline ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}
          >
            {isOnline ? (
              <><Wifi className="w-3 h-3 mr-1.5" /> Online</>
            ) : (
              <><WifiOff className="w-3 h-3 mr-1.5" /> Offline</>
            )}
          </Badge>
          {pendingSync > 0 && isOnline && (
            <Button 
              onClick={handleSync}
              disabled={isSyncing}
              className="bg-emerald-600 hover:bg-emerald-700"
            >
              <RefreshCw className={`w-4 h-4 mr-2 ${isSyncing ? 'animate-spin' : ''}`} />
              {isSyncing ? 'Syncing...' : 'Sync Now'}
            </Button>
          )}
          {syncSuccess && (
            <Badge className="bg-emerald-500 text-white animate-pulse">
              <CheckCircle2 className="w-3 h-3 mr-1" /> Synced!
            </Badge>
          )}
        </div>
      </div>

      {/* Offline Alert */}
      {!isOnline && (
        <Card className="bg-gradient-to-r from-amber-500 to-amber-600 border-0 text-white">
          <CardContent className="p-4 flex items-center gap-3">
            <WifiOff className="w-5 h-5" />
            <div>
              <p className="font-semibold">Offline Mode</p>
              <p className="text-sm text-amber-100">You can still collect data. It will sync when online.</p>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Pending Sync Alert */}
      {pendingSync > 0 && isOnline && (
        <Card className="bg-gradient-to-r from-blue-500 to-blue-600 border-0 text-white">
          <CardContent className="p-4 flex items-center justify-between">
            <div className="flex items-center gap-3">
              <CloudOff className="w-5 h-5" />
              <div>
                <p className="font-semibold">{pendingSync} submissions pending sync</p>
                <p className="text-sm text-blue-100">Click "Sync Now" to upload offline data</p>
              </div>
            </div>
            <Button 
              onClick={handleSync}
              disabled={isSyncing}
              variant="secondary"
              className="bg-white text-blue-600 hover:bg-blue-50"
            >
              {isSyncing ? 'Syncing...' : 'Sync Now'}
            </Button>
          </CardContent>
        </Card>
      )}

      {/* Assignment Info */}
      <Card className="bg-gradient-to-r from-emerald-500 to-emerald-600 border-0 text-white">
        <CardContent className="p-6">
          <div className="flex items-start justify-between">
            <div>
              <p className="text-emerald-100 text-sm mb-2">Assigned Location</p>
              <div className="flex items-center gap-2 mb-1">
                <MapPin className="w-5 h-5 text-emerald-200" />
                <span className="text-xl font-semibold">
                  {user?.assigned_ward || 'Not Assigned'}
                </span>
              </div>
              <p className="text-emerald-100 text-sm">
                {user?.assigned_lga || 'LGA Not Assigned'} Local Government
              </p>
            </div>
            <div className="text-right">
              <div className="flex items-center gap-2 text-emerald-100 text-sm">
                <Clock className="w-4 h-4" />
                Last Sync
              </div>
              <p className="text-sm mt-1">{lastSync}</p>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
        {stats.map((stat, index) => (
          <motion.div
            key={stat.title}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: index * 0.1 }}
          >
            <Card className="hover:shadow-lg transition-shadow duration-300">
              <CardContent className="p-6">
                <div className="flex items-start justify-between">
                  <div>
                    <p className="text-slate-500 text-sm">{stat.title}</p>
                    <p className="text-3xl font-bold text-slate-900 mt-1">{stat.value}</p>
                    {stat.trend && (
                      <div className="flex items-center gap-1 mt-2 text-emerald-600 text-xs">
                        <TrendingUp className="w-3 h-3" />
                        {stat.trend}
                      </div>
                    )}
                  </div>
                  <div className={`w-12 h-12 rounded-xl bg-${stat.color}-100 flex items-center justify-center`}>
                    <stat.icon className={`w-6 h-6 text-${stat.color}-600`} />
                  </div>
                </div>
              </CardContent>
            </Card>
          </motion.div>
        ))}
      </div>

      {/* Quick Actions */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Link to={createPageUrl('DataCollection')}>
          <Card className="hover:shadow-lg hover:border-emerald-200 transition-all duration-300 cursor-pointer group h-full">
            <CardContent className="p-4 sm:p-6 flex items-center gap-3 sm:gap-4">
              <div className="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-emerald-100 flex items-center justify-center group-hover:scale-110 transition-transform flex-shrink-0">
                <Plus className="w-6 h-6 sm:w-7 sm:h-7 text-emerald-600" />
              </div>
              <div className="flex-1 min-w-0">
                <h3 className="font-semibold text-slate-900 truncate">New Submission</h3>
                <p className="text-slate-500 text-sm truncate">Collect new farmer data</p>
              </div>
              <ChevronRight className="w-4 h-4 sm:w-5 sm:h-5 text-slate-400 group-hover:text-emerald-600 group-hover:translate-x-1 transition-all flex-shrink-0" />
            </CardContent>
          </Card>
        </Link>

        <Link to={createPageUrl('MySubmissions')}>
          <Card className="hover:shadow-lg hover:border-blue-200 transition-all duration-300 cursor-pointer group h-full">
            <CardContent className="p-4 sm:p-6 flex items-center gap-3 sm:gap-4">
              <div className="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-blue-100 flex items-center justify-center group-hover:scale-110 transition-transform flex-shrink-0">
                <FileText className="w-6 h-6 sm:w-7 sm:h-7 text-blue-600" />
              </div>
              <div className="flex-1 min-w-0">
                <h3 className="font-semibold text-slate-900 truncate">My Submissions</h3>
                <p className="text-slate-500 text-sm truncate">View all your submissions</p>
              </div>
              <ChevronRight className="w-4 h-4 sm:w-5 sm:h-5 text-slate-400 group-hover:text-blue-600 group-hover:translate-x-1 transition-all flex-shrink-0" />
            </CardContent>
          </Card>
        </Link>

        <Link to={createPageUrl('AgentSupport')}>
          <Card className="hover:shadow-lg hover:border-purple-200 transition-all duration-300 cursor-pointer group h-full">
            <CardContent className="p-4 sm:p-6 flex items-center gap-3 sm:gap-4">
              <div className="w-12 h-12 sm:w-14 sm:h-14 rounded-2xl bg-purple-100 flex items-center justify-center group-hover:scale-110 transition-transform flex-shrink-0">
                <AlertCircle className="w-6 h-6 sm:w-7 sm:h-7 text-purple-600" />
              </div>
              <div className="flex-1 min-w-0">
                <h3 className="font-semibold text-slate-900 truncate">Support Tickets</h3>
                <p className="text-slate-500 text-sm truncate">Get help & report issues</p>
              </div>
              <ChevronRight className="w-4 h-4 sm:w-5 sm:h-5 text-slate-400 group-hover:text-purple-600 group-hover:translate-x-1 transition-all flex-shrink-0" />
            </CardContent>
          </Card>
        </Link>
      </div>

      {/* Recent Submissions */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <div className="flex items-center justify-between">
            <CardTitle className="text-lg">Recent Submissions</CardTitle>
            <Link to={createPageUrl('MySubmissions')}>
              <Button variant="ghost" size="sm" className="text-emerald-600">
                View All
                <ChevronRight className="w-4 h-4 ml-1" />
              </Button>
            </Link>
          </div>
        </CardHeader>
        <CardContent className="p-0">
          {submissionsLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-6 h-6 animate-spin mx-auto text-slate-400" />
            </div>
          ) : submissions.length === 0 ? (
            <div className="p-8 text-center">
              <div className="w-16 h-16 mx-auto mb-4 bg-slate-100 rounded-full flex items-center justify-center">
                <FileText className="w-8 h-8 text-slate-400" />
              </div>
              <p className="text-slate-600 font-medium">No submissions yet</p>
              <p className="text-slate-400 text-sm mt-1">Start collecting data to see them here</p>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {submissions.slice(0, 5).map((submission) => (
                <div key={submission.id} className="p-4 hover:bg-slate-50 transition-colors">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="font-medium text-slate-900">{submission.farmer_name}</p>
                      <p className="text-slate-500 text-sm">{submission.association}</p>
                    </div>
                    <div className="flex items-center gap-3">
                      <Badge variant="outline" className="text-xs">
                        {submission.number_of_animals} animals
                      </Badge>
                      {submission.submission_status === 'synced' ? (
                        <CheckCircle2 className="w-5 h-5 text-emerald-500" />
                      ) : (
                        <AlertCircle className="w-5 h-5 text-amber-500" />
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}

agent Notification


import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import { Switch } from '@/components/ui/switch';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  Search,
  Users,
  UserPlus,
  Edit,
  RefreshCw,
  MapPin,
  Phone,
  Mail,
  CheckCircle2,
  XCircle,
  Filter
} from 'lucide-react';
import { format } from 'date-fns';
import { getLGAs, getWards } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function AgentManagement() {
  const [searchTerm, setSearchTerm] = useState('');
  const [filterLGA, setFilterLGA] = useState('all');
  const [filterStatus, setFilterStatus] = useState('all');
  const [editingUser, setEditingUser] = useState(null);
  const [editForm, setEditForm] = useState({});
  
  const queryClient = useQueryClient();

  const { data: users = [], isLoading } = useQuery({
    queryKey: ['allUsers'],
    queryFn: () => base44.entities.User.list(),
  });

  const { data: submissions = [] } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list(),
  });

  const updateUserMutation = useMutation({
    mutationFn: async ({ id, data, userName }) => {
      const result = await base44.entities.User.update(id, data);
      await logAudit(
        'user_updated',
        'User',
        `Updated user ${userName} - changes: ${Object.keys(data).join(', ')}`,
        { entity_id: id, changes: data }
      );
      return result;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['allUsers'] });
      setEditingUser(null);
    },
  });

  const agents = users.filter(u => u.user_role === 'agent');

  // Get submission counts per agent
  const submissionCounts = submissions.reduce((acc, sub) => {
    if (sub.created_by) {
      acc[sub.created_by] = (acc[sub.created_by] || 0) + 1;
    }
    return acc;
  }, {});

  // Apply filters
  const filteredAgents = agents.filter(agent => {
    const matchesSearch = 
      agent.full_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      agent.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      agent.phone_number?.includes(searchTerm);
    
    const matchesLGA = filterLGA === 'all' || agent.assigned_lga === filterLGA;
    const matchesStatus = filterStatus === 'all' || agent.status === filterStatus;
    
    return matchesSearch && matchesLGA && matchesStatus;
  });

  const handleEdit = (user) => {
    setEditingUser(user);
    setEditForm({
      user_role: user.user_role || 'agent',
      assigned_lga: user.assigned_lga || '',
      assigned_ward: user.assigned_ward || '',
      status: user.status || 'active',
      phone_number: user.phone_number || ''
    });
  };

  const handleSave = () => {
    updateUserMutation.mutate({
      id: editingUser.id,
      data: editForm,
      userName: editingUser.full_name
    });
  };

  const toggleStatus = (user) => {
    const newStatus = user.status === 'active' ? 'inactive' : 'active';
    updateUserMutation.mutate({
      id: user.id,
      data: { status: newStatus },
      userName: user.full_name
    });
  };

  const activeCount = agents.filter(a => a.status === 'active').length;
  const lgasCovered = new Set(agents.map(a => a.assigned_lga).filter(Boolean)).size;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Agent Management</h1>
          <p className="text-slate-500 mt-1">Manage ward collectors and their assignments</p>
        </div>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-slate-900">{agents.length}</p>
            <p className="text-slate-500 text-sm">Total Agents</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-emerald-600">{activeCount}</p>
            <p className="text-slate-500 text-sm">Active</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-blue-600">{lgasCovered}</p>
            <p className="text-slate-500 text-sm">LGAs Covered</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-purple-600">{agents.length - activeCount}</p>
            <p className="text-slate-500 text-sm">Inactive</p>
          </CardContent>
        </Card>
      </div>

      {/* Filters */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
          <Input
            placeholder="Search by name, email, or phone..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="pl-10"
          />
        </div>
        <Select value={filterLGA} onValueChange={setFilterLGA}>
          <SelectTrigger className="w-full sm:w-48">
            <MapPin className="w-4 h-4 mr-2 text-slate-400" />
            <SelectValue placeholder="Filter by LGA" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All LGAs</SelectItem>
            {getLGAs().map((lga) => (
              <SelectItem key={lga} value={lga}>{lga}</SelectItem>
            ))}
          </SelectContent>
        </Select>
        <Select value={filterStatus} onValueChange={setFilterStatus}>
          <SelectTrigger className="w-full sm:w-40">
            <Filter className="w-4 h-4 mr-2 text-slate-400" />
            <SelectValue placeholder="Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Status</SelectItem>
            <SelectItem value="active">Active</SelectItem>
            <SelectItem value="inactive">Inactive</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* Agents Table */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <Users className="w-5 h-5 text-emerald-600" />
            Agents ({filteredAgents.length})
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
            </div>
          ) : filteredAgents.length === 0 ? (
            <div className="p-8 text-center">
              <Users className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No agents found</p>
              <p className="text-slate-400 text-sm">Try adjusting your filters</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Agent</TableHead>
                    <TableHead>Contact</TableHead>
                    <TableHead>Assignment</TableHead>
                    <TableHead className="text-center">Submissions</TableHead>
                    <TableHead className="text-center">Status</TableHead>
                    <TableHead></TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {filteredAgents.map((agent) => (
                    <TableRow key={agent.id}>
                      <TableCell>
                        <div>
                          <p className="font-medium text-slate-900">{agent.full_name}</p>
                          <p className="text-xs text-slate-400">{agent.email}</p>
                        </div>
                      </TableCell>
                      <TableCell>
                        {agent.phone_number || '-'}
                      </TableCell>
                      <TableCell>
                        {agent.assigned_lga ? (
                          <div>
                            <Badge variant="outline" className="text-xs">
                              {agent.assigned_lga}
                            </Badge>
                            {agent.assigned_ward && (
                              <p className="text-xs text-slate-500 mt-1">{agent.assigned_ward}</p>
                            )}
                          </div>
                        ) : (
                          <span className="text-slate-400 text-sm">Not assigned</span>
                        )}
                      </TableCell>
                      <TableCell className="text-center">
                        <Badge className="bg-emerald-100 text-emerald-700">
                          {submissionCounts[agent.email] || 0}
                        </Badge>
                      </TableCell>
                      <TableCell className="text-center">
                        <div className="flex items-center justify-center gap-2">
                          {agent.status === 'active' ? (
                            <Badge className="bg-emerald-100 text-emerald-700">
                              <CheckCircle2 className="w-3 h-3 mr-1" /> Active
                            </Badge>
                          ) : (
                            <Badge className="bg-slate-100 text-slate-600">
                              <XCircle className="w-3 h-3 mr-1" /> Inactive
                            </Badge>
                          )}
                        </div>
                      </TableCell>
                      <TableCell>
                        <Button
                          variant="ghost"
                          size="sm"
                          onClick={() => handleEdit(agent)}
                        >
                          <Edit className="w-4 h-4" />
                        </Button>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </div>
          )}
        </CardContent>
      </Card>

      {/* Edit Dialog */}
      <Dialog open={!!editingUser} onOpenChange={() => setEditingUser(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Edit Agent</DialogTitle>
          </DialogHeader>
          {editingUser && (
            <div className="space-y-4">
              <div className="p-3 bg-slate-50 rounded-lg">
                <p className="font-medium">{editingUser.full_name}</p>
                <p className="text-sm text-slate-500">{editingUser.email}</p>
              </div>

              <div className="space-y-2">
                <Label>Phone Number</Label>
                <Input
                  value={editForm.phone_number}
                  onChange={(e) => setEditForm({ ...editForm, phone_number: e.target.value })}
                  placeholder="Enter phone number"
                />
              </div>

              <div className="space-y-2">
                <Label>Role</Label>
                <Select
                  value={editForm.user_role}
                  onValueChange={(v) => setEditForm({ ...editForm, user_role: v })}
                >
                  <SelectTrigger>
                    <SelectValue />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="agent">Agent</SelectItem>
                    <SelectItem value="support_officer">Support Officer</SelectItem>
                    <SelectItem value="admin">Admin</SelectItem>
                    <SelectItem value="super_admin">Super Admin</SelectItem>
                  </SelectContent>
                </Select>
              </div>

              <div className="space-y-2">
                <Label>Assigned LGA</Label>
                <Select
                  value={editForm.assigned_lga}
                  onValueChange={(v) => setEditForm({ ...editForm, assigned_lga: v, assigned_ward: '' })}
                >
                  <SelectTrigger>
                    <SelectValue placeholder="Select LGA" />
                  </SelectTrigger>
                  <SelectContent>
                    {getLGAs().map((lga) => (
                      <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>

              <div className="space-y-2">
                <Label>Assigned Ward</Label>
                <Select
                  value={editForm.assigned_ward}
                  onValueChange={(v) => setEditForm({ ...editForm, assigned_ward: v })}
                  disabled={!editForm.assigned_lga}
                >
                  <SelectTrigger>
                    <SelectValue placeholder="Select Ward" />
                  </SelectTrigger>
                  <SelectContent>
                    {editForm.assigned_lga && getWards(editForm.assigned_lga).map((ward) => (
                      <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>

              <div className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                <div>
                  <p className="font-medium">Account Status</p>
                  <p className="text-sm text-slate-500">
                    {editForm.status === 'active' ? 'Agent can access the system' : 'Agent is blocked'}
                  </p>
                </div>
                <Switch
                  checked={editForm.status === 'active'}
                  onCheckedChange={(checked) => setEditForm({ ...editForm, status: checked ? 'active' : 'inactive' })}
                />
              </div>
            </div>
          )}
          <DialogFooter>
            <Button variant="outline" onClick={() => setEditingUser(null)}>
              Cancel
            </Button>
            <Button 
              onClick={handleSave}
              disabled={updateUserMutation.isPending}
              className="bg-emerald-600 hover:bg-emerald-700"
            >
              {updateUserMutation.isPending ? (
                <RefreshCw className="w-4 h-4 animate-spin mr-2" />
              ) : null}
              Save Changes
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}


agent managemet


import React from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import {
  Bell,
  RefreshCw,
  CheckCircle,
  Circle,
  Megaphone,
  Clock
} from 'lucide-react';
import { format } from 'date-fns';

export default function AgentNotifications() {
  const queryClient = useQueryClient();

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: allNotifications = [], isLoading } = useQuery({
    queryKey: ['notifications'],
    queryFn: () => base44.entities.Notification.list('-created_date'),
  });

  // Filter notifications relevant to this agent
  const myNotifications = allNotifications.filter(n => {
    if (n.target_type === 'all') return true;
    if (n.target_type === 'lga' && n.target_lga === user?.assigned_lga) return true;
    if (n.target_type === 'ward' && n.target_ward === user?.assigned_ward) return true;
    if (n.target_type === 'individual' && n.target_agent_id === user?.id) return true;
    return false;
  });

  const unreadCount = myNotifications.filter(n => !n.is_read).length;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-2xl font-bold text-slate-900">Notifications</h1>
        <p className="text-slate-500 mt-1">Stay updated with announcements</p>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-slate-900">{myNotifications.length}</p>
            <p className="text-slate-500 text-sm">Total</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-emerald-600">{unreadCount}</p>
            <p className="text-slate-500 text-sm">Unread</p>
          </CardContent>
        </Card>
      </div>

      {/* Notifications List */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <Bell className="w-5 h-5 text-emerald-600" />
            My Notifications
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
            </div>
          ) : myNotifications.length === 0 ? (
            <div className="p-8 text-center">
              <Bell className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No notifications</p>
              <p className="text-slate-400 text-sm">You'll see announcements here</p>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {myNotifications.map((notification) => (
                <div 
                  key={notification.id} 
                  className={`p-4 transition-colors ${
                    notification.is_read ? 'bg-white' : 'bg-emerald-50/50'
                  }`}
                >
                  <div className="flex items-start gap-3">
                    <div className={`mt-1 ${notification.is_read ? 'text-slate-300' : 'text-emerald-500'}`}>
                      {notification.is_read ? (
                        <CheckCircle className="w-5 h-5" />
                      ) : (
                        <Circle className="w-5 h-5 fill-current" />
                      )}
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="font-semibold text-slate-900">
                          {notification.title}
                        </h3>
                        {notification.target_type === 'all' && (
                          <Badge className="bg-emerald-100 text-emerald-700 text-xs">
                            <Megaphone className="w-3 h-3 mr-1" /> Broadcast
                          </Badge>
                        )}
                      </div>
                      <p className="text-slate-600 text-sm">
                        {notification.message}
                      </p>
                      <div className="flex items-center gap-2 mt-2 text-xs text-slate-400">
                        <Clock className="w-3 h-3" />
                        {notification.created_date && format(new Date(notification.created_date), 'PPp')}
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>
    </div>
  );
}



agent support


import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  HelpCircle,
  Plus,
  RefreshCw,
  Clock,
  CheckCircle2,
  AlertCircle,
  XCircle,
  MessageSquare,
  Send
} from 'lucide-react';
import { format } from 'date-fns';

export default function AgentSupport() {
  const [showNewTicket, setShowNewTicket] = useState(false);
  const [selectedTicket, setSelectedTicket] = useState(null);
  const [newTicket, setNewTicket] = useState({
    subject: '',
    description: '',
    category: 'other',
    priority: 'medium'
  });

  const queryClient = useQueryClient();

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: tickets = [], isLoading } = useQuery({
    queryKey: ['myTickets', user?.email],
    queryFn: () => base44.entities.SupportTicket.filter({ created_by: user?.email }, '-created_date'),
    enabled: !!user?.email,
  });

  const createTicketMutation = useMutation({
    mutationFn: (data) => base44.entities.SupportTicket.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['myTickets'] });
      setShowNewTicket(false);
      setNewTicket({ subject: '', description: '', category: 'other', priority: 'medium' });
    },
  });

  const handleSubmitTicket = () => {
    createTicketMutation.mutate({
      ...newTicket,
      agent_id: user?.id,
      agent_name: user?.full_name,
      agent_lga: user?.assigned_lga,
      agent_ward: user?.assigned_ward,
      status: 'open'
    });
  };

  const getStatusBadge = (status) => {
    const styles = {
      open: 'bg-blue-100 text-blue-700',
      in_progress: 'bg-amber-100 text-amber-700',
      resolved: 'bg-emerald-100 text-emerald-700',
      closed: 'bg-slate-100 text-slate-600'
    };
    const icons = {
      open: AlertCircle,
      in_progress: Clock,
      resolved: CheckCircle2,
      closed: XCircle
    };
    const Icon = icons[status] || AlertCircle;
    return (
      <Badge className={`${styles[status] || styles.open} flex items-center gap-1`}>
        <Icon className="w-3 h-3" />
        {status?.replace('_', ' ')}
      </Badge>
    );
  };

  const openCount = tickets.filter(t => t.status === 'open' || t.status === 'in_progress').length;
  const resolvedCount = tickets.filter(t => t.status === 'resolved' || t.status === 'closed').length;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Support</h1>
          <p className="text-slate-500 mt-1">Get help with issues or questions</p>
        </div>
        <Button 
          onClick={() => setShowNewTicket(true)}
          className="bg-emerald-600 hover:bg-emerald-700"
        >
          <Plus className="w-4 h-4 mr-2" />
          New Ticket
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-slate-900">{tickets.length}</p>
            <p className="text-slate-500 text-sm">Total</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-amber-600">{openCount}</p>
            <p className="text-slate-500 text-sm">Active</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-emerald-600">{resolvedCount}</p>
            <p className="text-slate-500 text-sm">Resolved</p>
          </CardContent>
        </Card>
      </div>

      {/* Tickets List */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <MessageSquare className="w-5 h-5 text-emerald-600" />
            My Tickets
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
            </div>
          ) : tickets.length === 0 ? (
            <div className="p-8 text-center">
              <HelpCircle className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No tickets yet</p>
              <p className="text-slate-400 text-sm">Create a ticket if you need help</p>
              <Button 
                onClick={() => setShowNewTicket(true)}
                className="mt-4 bg-emerald-600 hover:bg-emerald-700"
              >
                <Plus className="w-4 h-4 mr-2" />
                Create Ticket
              </Button>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {tickets.map((ticket) => (
                <div
                  key={ticket.id}
                  className="p-4 hover:bg-slate-50 cursor-pointer transition-colors"
                  onClick={() => setSelectedTicket(ticket)}
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="font-semibold text-slate-900 truncate">
                          {ticket.subject}
                        </h3>
                        {getStatusBadge(ticket.status)}
                      </div>
                      <p className="text-slate-600 text-sm line-clamp-2">
                        {ticket.description}
                      </p>
                    </div>
                    <div className="text-right">
                      <Badge variant="outline" className="text-xs capitalize">
                        {ticket.category?.replace('_', ' ')}
                      </Badge>
                      <p className="text-xs text-slate-400 mt-1">
                        {ticket.created_date && format(new Date(ticket.created_date), 'MMM d')}
                      </p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* New Ticket Dialog */}
      <Dialog open={showNewTicket} onOpenChange={setShowNewTicket}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Create Support Ticket</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>Subject *</Label>
              <Input
                placeholder="Brief description of the issue"
                value={newTicket.subject}
                onChange={(e) => setNewTicket({ ...newTicket, subject: e.target.value })}
              />
            </div>

            <div className="space-y-2">
              <Label>Category</Label>
              <Select
                value={newTicket.category}
                onValueChange={(v) => setNewTicket({ ...newTicket, category: v })}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="technical">Technical Issue</SelectItem>
                  <SelectItem value="data_issue">Data Issue</SelectItem>
                  <SelectItem value="account">Account Problem</SelectItem>
                  <SelectItem value="sync_problem">Sync Problem</SelectItem>
                  <SelectItem value="other">Other</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label>Priority</Label>
              <Select
                value={newTicket.priority}
                onValueChange={(v) => setNewTicket({ ...newTicket, priority: v })}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="low">Low</SelectItem>
                  <SelectItem value="medium">Medium</SelectItem>
                  <SelectItem value="high">High</SelectItem>
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-2">
              <Label>Description *</Label>
              <Textarea
                placeholder="Please describe your issue in detail..."
                value={newTicket.description}
                onChange={(e) => setNewTicket({ ...newTicket, description: e.target.value })}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowNewTicket(false)}>
              Cancel
            </Button>
            <Button
              onClick={handleSubmitTicket}
              disabled={!newTicket.subject || !newTicket.description || createTicketMutation.isPending}
              className="bg-emerald-600 hover:bg-emerald-700"
            >
              {createTicketMutation.isPending ? (
                <RefreshCw className="w-4 h-4 animate-spin mr-2" />
              ) : (
                <Send className="w-4 h-4 mr-2" />
              )}
              Submit Ticket
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Ticket Detail Dialog */}
      <Dialog open={!!selectedTicket} onOpenChange={() => setSelectedTicket(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Ticket Details</DialogTitle>
          </DialogHeader>
          {selectedTicket && (
            <div className="space-y-4">
              <div className="flex items-center gap-2">
                {getStatusBadge(selectedTicket.status)}
                <Badge variant="outline" className="capitalize">
                  {selectedTicket.category?.replace('_', ' ')}
                </Badge>
              </div>

              <div>
                <h3 className="font-semibold text-lg">{selectedTicket.subject}</h3>
                <p className="text-slate-500 text-sm">
                  Created {selectedTicket.created_date && format(new Date(selectedTicket.created_date), 'PPp')}
                </p>
              </div>

              <div className="p-4 bg-slate-50 rounded-lg">
                <p className="text-slate-700 whitespace-pre-wrap">{selectedTicket.description}</p>
              </div>

              {selectedTicket.status === 'resolved' && (
                <div className="p-4 bg-emerald-50 rounded-lg border border-emerald-200">
                  <p className="font-medium text-emerald-800 flex items-center gap-2">
                    <CheckCircle2 className="w-4 h-4" />
                    This ticket has been resolved
                  </p>
                </div>
              )}

              {selectedTicket.status === 'in_progress' && (
                <div className="p-4 bg-amber-50 rounded-lg border border-amber-200">
                  <p className="font-medium text-amber-800 flex items-center gap-2">
                    <Clock className="w-4 h-4" />
                    Support is working on your issue
                  </p>
                </div>
              )}
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}


bulk sms



import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  MessageSquare,
  Send,
  Users,
  AlertCircle,
  CheckCircle2
} from 'lucide-react';
import { getLGAs, getWards, ASSOCIATIONS } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function BulkSMS() {
  const [targetType, setTargetType] = useState('all');
  const [selectedLGA, setSelectedLGA] = useState('');
  const [selectedWard, setSelectedWard] = useState('');
  const [selectedAssociation, setSelectedAssociation] = useState('');
  const [message, setMessage] = useState('');
  const [isSending, setIsSending] = useState(false);
  const [sendResult, setSendResult] = useState(null);

  const { data: submissions = [] } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list(),
  });

  const getTargetedBeneficiaries = () => {
    return submissions.filter(sub => {
      if (targetType === 'all') return true;
      if (targetType === 'lga' && selectedLGA) {
        return sub.lga === selectedLGA;
      }
      if (targetType === 'ward' && selectedLGA && selectedWard) {
        return sub.lga === selectedLGA && sub.ward === selectedWard;
      }
      if (targetType === 'association' && selectedAssociation) {
        return sub.association === selectedAssociation;
      }
      return false;
    });
  };

  const targetedBeneficiaries = getTargetedBeneficiaries();
  const recipientCount = targetedBeneficiaries.filter(b => b.contact_number).length;

  const handleSendSMS = async () => {
    if (!message.trim()) {
      alert('Please enter a message');
      return;
    }

    if (recipientCount === 0) {
      alert('No recipients with phone numbers found');
      return;
    }

    setIsSending(true);
    setSendResult(null);

    try {
      // Note: This requires backend functions to be enabled
      // For now, we'll simulate the sending
      const recipients = targetedBeneficiaries
        .filter(b => b.contact_number)
        .map(b => ({
          phone: b.contact_number,
          name: b.farmer_name
        }));

      // In a real implementation with backend functions:
      // await base44.integrations.SMS.SendBulkSMS({
      //   recipients: recipients.map(r => r.phone),
      //   message: message
      // });

      // Simulate sending delay
      await new Promise(resolve => setTimeout(resolve, 2000));

      await logAudit(
        'bulk_action',
        'Notification',
        `Sent bulk SMS to ${recipientCount} beneficiaries`,
        { 
          target_type: targetType,
          recipient_count: recipientCount,
          message_preview: message.substring(0, 50)
        }
      );

      setSendResult({
        success: true,
        count: recipientCount
      });
      setMessage('');
    } catch (error) {
      console.error('SMS sending error:', error);
      setSendResult({
        success: false,
        error: error.message
      });
    } finally {
      setIsSending(false);
    }
  };

  return (
    <div className="space-y-6 max-w-4xl mx-auto">
      <div>
        <h1 className="text-2xl font-bold text-slate-900">Bulk SMS Notification</h1>
        <p className="text-slate-500 mt-1">Send targeted SMS messages to beneficiaries</p>
      </div>

      <Card className="bg-amber-50 border-amber-200">
        <CardContent className="p-4 flex items-start gap-3">
          <AlertCircle className="w-5 h-5 text-amber-600 mt-0.5" />
          <div>
            <p className="font-medium text-amber-900">Backend Functions Required</p>
            <p className="text-sm text-amber-700">
              To send actual SMS messages, backend functions need to be enabled in your app settings.
              Currently in simulation mode.
            </p>
          </div>
        </CardContent>
      </Card>

      <div className="grid md:grid-cols-2 gap-6">
        <Card>
          <CardHeader className="border-b">
            <CardTitle>Target Audience</CardTitle>
          </CardHeader>
          <CardContent className="p-6 space-y-4">
            <div>
              <Label>Target Type</Label>
              <Select value={targetType} onValueChange={(v) => {
                setTargetType(v);
                setSelectedLGA('');
                setSelectedWard('');
                setSelectedAssociation('');
              }}>
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Beneficiaries</SelectItem>
                  <SelectItem value="lga">Specific LGA</SelectItem>
                  <SelectItem value="ward">Specific Ward</SelectItem>
                  <SelectItem value="association">Specific Association</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {targetType === 'lga' && (
              <div>
                <Label>Select LGA</Label>
                <Select value={selectedLGA} onValueChange={setSelectedLGA}>
                  <SelectTrigger>
                    <SelectValue placeholder="Choose LGA" />
                  </SelectTrigger>
                  <SelectContent>
                    {getLGAs().map((lga) => (
                      <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}

            {targetType === 'ward' && (
              <>
                <div>
                  <Label>Select LGA</Label>
                  <Select value={selectedLGA} onValueChange={(v) => {
                    setSelectedLGA(v);
                    setSelectedWard('');
                  }}>
                    <SelectTrigger>
                      <SelectValue placeholder="Choose LGA" />
                    </SelectTrigger>
                    <SelectContent>
                      {getLGAs().map((lga) => (
                        <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div>
                  <Label>Select Ward</Label>
                  <Select value={selectedWard} onValueChange={setSelectedWard} disabled={!selectedLGA}>
                    <SelectTrigger>
                      <SelectValue placeholder="Choose Ward" />
                    </SelectTrigger>
                    <SelectContent>
                      {selectedLGA && getWards(selectedLGA).map((ward) => (
                        <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              </>
            )}

            {targetType === 'association' && (
              <div>
                <Label>Select Association</Label>
                <Select value={selectedAssociation} onValueChange={setSelectedAssociation}>
                  <SelectTrigger>
                    <SelectValue placeholder="Choose Association" />
                  </SelectTrigger>
                  <SelectContent>
                    {ASSOCIATIONS.map((assoc) => (
                      <SelectItem key={assoc} value={assoc}>{assoc}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}

            <Card className="bg-emerald-50 border-emerald-200">
              <CardContent className="p-4 text-center">
                <Users className="w-8 h-8 text-emerald-600 mx-auto mb-2" />
                <p className="text-2xl font-bold text-emerald-900">{recipientCount}</p>
                <p className="text-sm text-emerald-700">Recipients with phone numbers</p>
              </CardContent>
            </Card>
          </CardContent>
        </Card>

        <Card>
          <CardHeader className="border-b">
            <CardTitle>Compose Message</CardTitle>
          </CardHeader>
          <CardContent className="p-6 space-y-4">
            <div>
              <Label>Message Content</Label>
              <Textarea
                placeholder="Type your message here..."
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                rows={8}
                maxLength={160}
              />
              <p className="text-sm text-slate-500 mt-1">
                {message.length}/160 characters
              </p>
            </div>

            <Button
              onClick={handleSendSMS}
              disabled={isSending || !message.trim() || recipientCount === 0}
              className="w-full bg-emerald-600 hover:bg-emerald-700"
            >
              {isSending ? (
                <>
                  <MessageSquare className="w-4 h-4 mr-2 animate-pulse" />
                  Sending...
                </>
              ) : (
                <>
                  <Send className="w-4 h-4 mr-2" />
                  Send to {recipientCount} Recipients
                </>
              )}
            </Button>

            {sendResult && (
              <Card className={sendResult.success ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}>
                <CardContent className="p-4 flex items-center gap-3">
                  {sendResult.success ? (
                    <>
                      <CheckCircle2 className="w-5 h-5 text-green-600" />
                      <div>
                        <p className="font-medium text-green-900">Messages Sent Successfully</p>
                        <p className="text-sm text-green-700">
                          Sent to {sendResult.count} beneficiaries
                        </p>
                      </div>
                    </>
                  ) : (
                    <>
                      <AlertCircle className="w-5 h-5 text-red-600" />
                      <div>
                        <p className="font-medium text-red-900">Sending Failed</p>
                        <p className="text-sm text-red-700">{sendResult.error}</p>
                      </div>
                    </>
                  )}
                </CardContent>
              </Card>
            )}
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader className="border-b">
          <CardTitle>Target Preview</CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          <div className="max-h-64 overflow-y-auto">
            {targetedBeneficiaries.length === 0 ? (
              <p className="text-slate-500 text-center py-4">No beneficiaries match your selection</p>
            ) : (
              <div className="space-y-2">
                {targetedBeneficiaries.slice(0, 10).map((beneficiary) => (
                  <div
                    key={beneficiary.id}
                    className="flex items-center justify-between p-3 bg-slate-50 rounded-lg"
                  >
                    <div>
                      <p className="font-medium">{beneficiary.farmer_name}</p>
                      <p className="text-sm text-slate-500">{beneficiary.contact_number || 'No phone'}</p>
                    </div>
                    <Badge variant="outline">{beneficiary.ward}, {beneficiary.lga}</Badge>
                  </div>
                ))}
                {targetedBeneficiaries.length > 10 && (
                  <p className="text-sm text-slate-500 text-center pt-2">
                    And {targetedBeneficiaries.length - 10} more...
                  </p>
                )}
              </div>
            )}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}




data HTMLAllCollection


import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { createPageUrl } from '@/utils';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { motion, AnimatePresence } from 'framer-motion';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent
} from '@/components/ui/dialog';
import {
  User,
  Phone,
  CreditCard,
  Building,
  MapPin,
  ChevronRight,
  ChevronLeft,
  Save,
  Check,
  Wifi,
  WifiOff,
  RefreshCw,
  AlertCircle,
  Navigation,
  CheckCircle2,
  Camera,
  Upload,
  X
} from 'lucide-react';
import { getLGAs, getWards, ASSOCIATIONS, BANKS } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function DataCollection() {
  const navigate = useNavigate();
  const [currentStep, setCurrentStep] = useState(0);
  const [isOnline, setIsOnline] = useState(navigator.onLine);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [errors, setErrors] = useState({});
  const [geoLocation, setGeoLocation] = useState(null);
  const [geoError, setGeoError] = useState(null);

  const [formData, setFormData] = useState({
    farmer_name: '',
    contact_number: '',
    user_photograph: '',
    bvn: '',
    nin: '',
    vin: '',
    account_number: '',
    bank: '',
    account_name: '',
    lga: '',
    ward: '',
    association: '',
    membership_status: 'ordinary_member',
    executive_position: '',
    number_of_animals: '',
    has_disease: false,
    disease_name: '',
    disease_description: '',
    remarks: ''
  });

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  useEffect(() => {
    if (user?.assigned_lga && user?.assigned_ward) {
      setFormData(prev => ({
        ...prev,
        lga: user.assigned_lga,
        ward: user.assigned_ward
      }));
    }

    // Capture GPS coordinates
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const coords = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
          setGeoLocation(coords);
          setGeoError(null);
        },
        (error) => {
          setGeoError('Unable to get location');
          console.error('Geolocation error:', error);
        }
      );
    } else {
      setGeoError('Geolocation not supported');
    }
  }, [user]);

  const [isUploadingPhoto, setIsUploadingPhoto] = useState(false);

  const steps = [
    { title: 'Farmer Info', icon: User },
    { title: 'Bank Details', icon: CreditCard },
    { title: 'Location', icon: MapPin },
    { title: 'Association', icon: Building }
  ];

  const handleInputChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    if (errors[field]) {
      setErrors(prev => ({ ...prev, [field]: null }));
    }
  };

  const validateStep = (step) => {
    const newErrors = {};
    
    if (step === 0) {
      if (!formData.farmer_name.trim()) newErrors.farmer_name = 'Farmer name is required';
      if (!formData.contact_number.trim()) newErrors.contact_number = 'Contact number is required';
    }
    
    if (step === 2) {
      if (!formData.lga) newErrors.lga = 'LGA is required';
      if (!formData.ward) newErrors.ward = 'Ward is required';
    }
    
    if (step === 3) {
      if (!formData.association) newErrors.association = 'Association is required';
      if (!formData.number_of_animals) newErrors.number_of_animals = 'Number of animals is required';
    }
    
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleNext = () => {
    if (validateStep(currentStep)) {
      setCurrentStep(prev => Math.min(prev + 1, steps.length - 1));
    }
  };

  const handleBack = () => {
    setCurrentStep(prev => Math.max(prev - 1, 0));
  };

  const [showSuccessDialog, setShowSuccessDialog] = useState(false);

  const generateRegistrationId = () => {
    const timestamp = Date.now().toString(36).toUpperCase();
    const random = Math.random().toString(36).substring(2, 6).toUpperCase();
    const lgaCode = formData.lga?.substring(0, 3).toUpperCase() || 'XXX';
    return `JSM-${lgaCode}-${timestamp}-${random}`;
  };

  const handleSubmit = async () => {
    if (!validateStep(currentStep)) return;
    
    setIsSubmitting(true);
    
    const registrationId = generateRegistrationId();
    
    const submissionData = {
      ...formData,
      registration_id: registrationId,
      number_of_animals: parseInt(formData.number_of_animals),
      agent_id: user?.id,
      agent_name: user?.full_name,
      submission_status: isOnline ? 'synced' : 'pending',
      geo_location: geoLocation || null
    };
    
    try {
      if (isOnline) {
        const result = await base44.entities.LivestockSubmission.create(submissionData);
        await logAudit(
          'submission_created',
          'LivestockSubmission',
          `Created submission for farmer ${formData.farmer_name} in ${formData.ward}, ${formData.lga}`,
          { entity_id: result.id, farmer_name: formData.farmer_name, lga: formData.lga, ward: formData.ward }
        );
      } else {
        const pending = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');
        pending.push({ ...submissionData, offline_id: Date.now() });
        localStorage.setItem('pendingSubmissions', JSON.stringify(pending));
      }
      setShowSuccessDialog(true);
      setTimeout(() => {
        navigate(createPageUrl('MySubmissions'));
      }, 2000);
    } catch (error) {
      console.error('Submission error:', error);
    } finally {
      setIsSubmitting(false);
    }
  };

  const isAgentLocked = user?.assigned_lga && user?.assigned_ward;

  return (
    <>
    <div className="max-w-2xl mx-auto">
      {/* Header */}
      <div className="mb-6">
        <div className="flex items-center justify-between mb-2">
          <h1 className="text-2xl font-bold text-slate-900">New Submission</h1>
          <Badge 
            className={`${isOnline ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'}`}
          >
            {isOnline ? (
              <><Wifi className="w-3 h-3 mr-1" /> Online</>
            ) : (
              <><WifiOff className="w-3 h-3 mr-1" /> Offline Mode</>
            )}
          </Badge>
        </div>
        <p className="text-slate-500">Collect farmer and livestock data</p>
      </div>

      {/* Progress Steps */}
      <div className="mb-8">
        <div className="flex items-center justify-between">
          {steps.map((step, index) => (
            <React.Fragment key={step.title}>
              <div 
                className={`flex flex-col items-center ${
                  index <= currentStep ? 'text-emerald-600' : 'text-slate-400'
                }`}
              >
                <div className={`
                  w-10 h-10 rounded-full flex items-center justify-center mb-2 transition-all
                  ${index < currentStep 
                    ? 'bg-emerald-600 text-white' 
                    : index === currentStep 
                      ? 'bg-emerald-100 text-emerald-600 ring-4 ring-emerald-50' 
                      : 'bg-slate-100 text-slate-400'
                  }
                `}>
                  {index < currentStep ? (
                    <Check className="w-5 h-5" />
                  ) : (
                    <step.icon className="w-5 h-5" />
                  )}
                </div>
                <span className="text-xs font-medium hidden sm:block">{step.title}</span>
              </div>
              {index < steps.length - 1 && (
                <div className={`flex-1 h-0.5 mx-2 ${
                  index < currentStep ? 'bg-emerald-600' : 'bg-slate-200'
                }`} />
              )}
            </React.Fragment>
          ))}
        </div>
      </div>

      {/* Form Card */}
      <Card className="shadow-lg">
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="flex items-center gap-2">
            {React.createElement(steps[currentStep].icon, { className: "w-5 h-5 text-emerald-600" })}
            {steps[currentStep].title}
          </CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          <AnimatePresence mode="wait">
            <motion.div
              key={currentStep}
              initial={{ opacity: 0, x: 20 }}
              animate={{ opacity: 1, x: 0 }}
              exit={{ opacity: 0, x: -20 }}
              transition={{ duration: 0.2 }}
              className="space-y-4"
            >
              {currentStep === 0 && (
                <>
                  <div className="space-y-2">
                    <Label htmlFor="farmer_name">Farmer Name *</Label>
                    <Input
                      id="farmer_name"
                      placeholder="Enter farmer's full name"
                      value={formData.farmer_name}
                      onChange={(e) => handleInputChange('farmer_name', e.target.value)}
                      className={errors.farmer_name ? 'border-red-300' : ''}
                    />
                    {errors.farmer_name && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.farmer_name}
                      </p>
                    )}
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="user_photograph">User Photograph</Label>
                    <div className="flex gap-4 items-start">
                      {formData.user_photograph ? (
                        <div className="relative">
                          <img
                            src={formData.user_photograph}
                            alt="User"
                            className="w-24 h-24 object-cover rounded-lg border-2 border-slate-200"
                          />
                          <Button
                            size="sm"
                            variant="destructive"
                            className="absolute -top-2 -right-2 w-6 h-6 p-0 rounded-full"
                            onClick={() => handleInputChange('user_photograph', '')}
                          >
                            <X className="w-3 h-3" />
                          </Button>
                        </div>
                      ) : (
                        <div className="w-24 h-24 bg-slate-100 rounded-lg flex items-center justify-center">
                          <Camera className="w-8 h-8 text-slate-400" />
                        </div>
                      )}
                      <div className="flex-1">
                        <Input
                          id="user_photograph"
                          type="file"
                          accept="image/*"
                          capture="environment"
                          onChange={async (e) => {
                            const file = e.target.files?.[0];
                            if (file) {
                              setIsUploadingPhoto(true);
                              try {
                                const result = await base44.integrations.Core.UploadFile({ file });
                                handleInputChange('user_photograph', result.file_url);
                              } catch (error) {
                                alert('Failed to upload photo');
                              } finally {
                                setIsUploadingPhoto(false);
                              }
                            }
                          }}
                          disabled={isUploadingPhoto}
                          className="mb-2"
                        />
                        <p className="text-xs text-slate-500">Upload or capture user's photograph</p>
                        {isUploadingPhoto && (
                          <p className="text-xs text-emerald-600 flex items-center gap-1 mt-1">
                            <RefreshCw className="w-3 h-3 animate-spin" />
                            Uploading...
                          </p>
                        )}
                      </div>
                    </div>
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="contact_number">Contact Number *</Label>
                    <Input
                      id="contact_number"
                      placeholder="08012345678"
                      value={formData.contact_number}
                      onChange={(e) => handleInputChange('contact_number', e.target.value)}
                      className={errors.contact_number ? 'border-red-300' : ''}
                    />
                    {errors.contact_number && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.contact_number}
                      </p>
                    )}
                  </div>
                  <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div className="space-y-2">
                      <Label htmlFor="bvn">BVN</Label>
                      <Input
                        id="bvn"
                        placeholder="Bank Verification Number"
                        value={formData.bvn}
                        onChange={(e) => handleInputChange('bvn', e.target.value)}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="nin">NIN</Label>
                      <Input
                        id="nin"
                        placeholder="National ID Number"
                        value={formData.nin}
                        onChange={(e) => handleInputChange('nin', e.target.value)}
                      />
                    </div>
                    <div className="space-y-2">
                      <Label htmlFor="vin">VIN</Label>
                      <Input
                        id="vin"
                        placeholder="Voter ID Number"
                        value={formData.vin}
                        onChange={(e) => handleInputChange('vin', e.target.value)}
                      />
                    </div>
                  </div>
                </>
              )}

              {currentStep === 1 && (
                <>
                  <div className="space-y-2">
                    <Label htmlFor="bank">Bank</Label>
                    <Select
                      value={formData.bank}
                      onValueChange={(value) => handleInputChange('bank', value)}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Select bank" />
                      </SelectTrigger>
                      <SelectContent>
                        {BANKS.map((bank) => (
                          <SelectItem key={bank} value={bank}>{bank}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="account_number">Account Number</Label>
                    <Input
                      id="account_number"
                      placeholder="Enter account number"
                      value={formData.account_number}
                      onChange={(e) => handleInputChange('account_number', e.target.value)}
                    />
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="account_name">Account Name</Label>
                    <Input
                      id="account_name"
                      placeholder="Enter account holder name"
                      value={formData.account_name}
                      onChange={(e) => handleInputChange('account_name', e.target.value)}
                    />
                  </div>
                </>
              )}

              {currentStep === 2 && (
                <>
                  <div className="space-y-2">
                    <Label htmlFor="lga">Local Government Area (LGA) *</Label>
                    <Select
                      value={formData.lga}
                      onValueChange={(value) => {
                        handleInputChange('lga', value);
                        handleInputChange('ward', '');
                      }}
                      disabled={isAgentLocked}
                    >
                      <SelectTrigger className={errors.lga ? 'border-red-300' : ''}>
                        <SelectValue placeholder="Select LGA" />
                      </SelectTrigger>
                      <SelectContent>
                        {getLGAs().map((lga) => (
                          <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    {isAgentLocked && (
                      <p className="text-slate-500 text-xs">Location is locked to your assigned area</p>
                    )}
                    {errors.lga && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.lga}
                      </p>
                    )}
                  </div>
                  <div className="space-y-2">
                    <Label htmlFor="ward">Ward *</Label>
                    <Select
                      value={formData.ward}
                      onValueChange={(value) => handleInputChange('ward', value)}
                      disabled={isAgentLocked || !formData.lga}
                    >
                      <SelectTrigger className={errors.ward ? 'border-red-300' : ''}>
                        <SelectValue placeholder="Select ward" />
                      </SelectTrigger>
                      <SelectContent>
                        {getWards(formData.lga).map((ward) => (
                          <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    {errors.ward && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.ward}
                      </p>
                    )}
                  </div>
                </>
              )}

              {currentStep === 3 && (
                <>
                  <div className="space-y-2">
                    <Label htmlFor="association">Association Type *</Label>
                    <Select
                      value={formData.association}
                      onValueChange={(value) => handleInputChange('association', value)}
                    >
                      <SelectTrigger className={errors.association ? 'border-red-300' : ''}>
                        <SelectValue placeholder="Select association" />
                      </SelectTrigger>
                      <SelectContent>
                        {ASSOCIATIONS.map((assoc) => (
                          <SelectItem key={assoc} value={assoc}>{assoc}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    {errors.association && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.association}
                      </p>
                    )}
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="membership_status">Membership Status *</Label>
                    <Select
                      value={formData.membership_status}
                      onValueChange={(value) => {
                        handleInputChange('membership_status', value);
                        if (value === 'ordinary_member') {
                          handleInputChange('executive_position', '');
                        }
                      }}
                    >
                      <SelectTrigger>
                        <SelectValue placeholder="Select status" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value="ordinary_member">Ordinary Member</SelectItem>
                        <SelectItem value="executive_member">Executive/Ranked Member</SelectItem>
                      </SelectContent>
                    </Select>
                  </div>

                  {formData.membership_status === 'executive_member' && (
                    <div className="space-y-2">
                      <Label htmlFor="executive_position">Position/Title *</Label>
                      <Input
                        id="executive_position"
                        placeholder="e.g., Chairman, Secretary, Treasurer"
                        value={formData.executive_position}
                        onChange={(e) => handleInputChange('executive_position', e.target.value)}
                      />
                    </div>
                  )}

                  <div className="space-y-2">
                    <Label htmlFor="number_of_animals">Number of Animals *</Label>
                    <Input
                      id="number_of_animals"
                      type="number"
                      min="0"
                      placeholder="Enter number"
                      value={formData.number_of_animals}
                      onChange={(e) => handleInputChange('number_of_animals', e.target.value)}
                      className={errors.number_of_animals ? 'border-red-300' : ''}
                    />
                    {errors.number_of_animals && (
                      <p className="text-red-500 text-sm flex items-center gap-1">
                        <AlertCircle className="w-3 h-3" /> {errors.number_of_animals}
                      </p>
                    )}
                  </div>
                  <div className="space-y-2">
                    <Label>Livestock Disease Information</Label>
                    <div className="flex gap-4 mb-2">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          name="has_disease"
                          checked={formData.has_disease === false}
                          onChange={() => {
                            handleInputChange('has_disease', false);
                            handleInputChange('disease_name', '');
                            handleInputChange('disease_description', '');
                          }}
                          className="w-4 h-4"
                        />
                        <span>No Disease</span>
                      </label>
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input
                          type="radio"
                          name="has_disease"
                          checked={formData.has_disease === true}
                          onChange={() => handleInputChange('has_disease', true)}
                          className="w-4 h-4"
                        />
                        <span>Has Disease</span>
                      </label>
                    </div>

                    {formData.has_disease && (
                      <div className="space-y-3 pl-4 border-l-2 border-amber-200 bg-amber-50/30 p-3 rounded">
                        <div>
                          <Label htmlFor="disease_name">Disease Name</Label>
                          <Input
                            id="disease_name"
                            placeholder="Name of the disease"
                            value={formData.disease_name}
                            onChange={(e) => handleInputChange('disease_name', e.target.value)}
                          />
                        </div>
                        <div>
                          <Label htmlFor="disease_description">Disease Description</Label>
                          <Textarea
                            id="disease_description"
                            placeholder="Detailed description of the disease"
                            value={formData.disease_description}
                            onChange={(e) => handleInputChange('disease_description', e.target.value)}
                            rows={3}
                          />
                        </div>
                      </div>
                    )}
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="remarks">Remarks (Optional)</Label>
                    <Textarea
                      id="remarks"
                      placeholder="Any additional notes..."
                      value={formData.remarks}
                      onChange={(e) => handleInputChange('remarks', e.target.value)}
                      rows={3}
                    />
                  </div>
                </>
              )}
            </motion.div>
          </AnimatePresence>
        </CardContent>

        {/* Navigation */}
        <div className="px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between">
          <Button
            variant="outline"
            onClick={handleBack}
            disabled={currentStep === 0}
            className="gap-2"
            type="button"
          >
            <ChevronLeft className="w-4 h-4" />
            Back
          </Button>
          
          {currentStep < steps.length - 1 ? (
            <Button 
              onClick={handleNext}
              className="bg-emerald-600 hover:bg-emerald-700 gap-2"
            >
              Next
              <ChevronRight className="w-4 h-4" />
            </Button>
          ) : (
            <Button 
              onClick={handleSubmit}
              disabled={isSubmitting}
              className="bg-emerald-600 hover:bg-emerald-700 gap-2"
            >
              {isSubmitting ? (
                <>
                  <RefreshCw className="w-4 h-4 animate-spin" />
                  Saving...
                </>
              ) : (
                <>
                  <Save className="w-4 h-4" />
                  Submit
                </>
              )}
            </Button>
          )}
        </div>
      </Card>

      {/* Offline Mode Banner */}
      {!isOnline && (
        <Card className="mt-4 bg-amber-50 border-amber-200">
          <CardContent className="p-4 flex items-center gap-3">
            <WifiOff className="w-5 h-5 text-amber-600" />
            <div>
              <p className="font-medium text-amber-900">Offline Mode Active</p>
              <p className="text-sm text-amber-700">Your submission will be saved locally and synced when you're back online.</p>
            </div>
          </CardContent>
        </Card>
      )}

      {/* GPS Status */}
      {geoLocation ? (
        <Card className="mt-4 bg-emerald-50 border-emerald-200">
          <CardContent className="p-4 flex items-center gap-3">
            <Navigation className="w-5 h-5 text-emerald-600" />
            <div className="flex-1">
              <p className="font-medium text-emerald-900">Location Captured</p>
              <p className="text-sm text-emerald-700 font-mono">{geoLocation}</p>
            </div>
          </CardContent>
        </Card>
      ) : geoError ? (
        <Card className="mt-4 bg-slate-50 border-slate-200">
          <CardContent className="p-4 flex items-center gap-3">
            <MapPin className="w-5 h-5 text-slate-400" />
            <div>
              <p className="font-medium text-slate-700">Location Not Available</p>
              <p className="text-sm text-slate-500">Enable location services for geo-tagging</p>
            </div>
          </CardContent>
        </Card>
      ) : null}
    </div>

    {/* Success Dialog */}
    <Dialog open={showSuccessDialog} onOpenChange={setShowSuccessDialog}>
      <DialogContent className="max-w-sm">
        <div className="text-center py-6">
          <div className="w-16 h-16 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-4">
            {isOnline ? (
              <CheckCircle2 className="w-8 h-8 text-emerald-600" />
            ) : (
              <Save className="w-8 h-8 text-amber-600" />
            )}
          </div>
          <h3 className="text-xl font-bold text-slate-900 mb-2">
            {isOnline ? 'Submitted Successfully!' : 'Saved Offline'}
          </h3>
          <p className="text-slate-600">
            {isOnline 
              ? 'Your submission has been synced to the server.' 
              : 'Your submission is saved and will sync when online.'}
          </p>
        </div>
      </DialogContent>
    </Dialog>
    </>
  );
}


datamanagement


import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { Label } from '@/components/ui/label';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Search,
  Filter,
  Download,
  RefreshCw,
  FileSpreadsheet,
  Eye,
  Calendar,
  MapPin,
  User,
  Phone,
  Building,
  Navigation
} from 'lucide-react';
import { format } from 'date-fns';
import { getLGAs, getWards, ASSOCIATIONS } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function DataManagement() {
  const [searchTerm, setSearchTerm] = useState('');
  const [filterLGA, setFilterLGA] = useState('all');
  const [filterWard, setFilterWard] = useState('all');
  const [filterAssociation, setFilterAssociation] = useState('all');
  const [dateFrom, setDateFrom] = useState('');
  const [dateTo, setDateTo] = useState('');
  const [selectedSubmission, setSelectedSubmission] = useState(null);

  const { data: submissions = [], isLoading, refetch } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list('-created_date'),
  });

  // Apply filters
  const filteredSubmissions = submissions.filter(sub => {
    const matchesSearch = 
      sub.farmer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.contact_number?.includes(searchTerm) ||
      sub.registration_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.nin?.includes(searchTerm) ||
      sub.bvn?.includes(searchTerm);
    
    const matchesLGA = filterLGA === 'all' || sub.lga === filterLGA;
    const matchesWard = filterWard === 'all' || sub.ward === filterWard;
    const matchesAssociation = filterAssociation === 'all' || sub.association === filterAssociation;
    
    let matchesDate = true;
    if (dateFrom && sub.created_date) {
      matchesDate = new Date(sub.created_date) >= new Date(dateFrom);
    }
    if (dateTo && sub.created_date) {
      matchesDate = matchesDate && new Date(sub.created_date) <= new Date(dateTo + 'T23:59:59');
    }
    
    return matchesSearch && matchesLGA && matchesWard && matchesAssociation && matchesDate;
  });

  // Export functions
  const exportToCSV = async () => {
    const headers = [
      'Registration ID', 'Farmer Name', 'Contact', 'BVN', 'NIN', 'VIN', 
      'Bank', 'Account Number', 'Account Name',
      'LGA', 'Ward', 'Association', 'Membership', 'Position', 'Animals', 
      'GPS Coordinates', 'Date'
    ];
    
    const rows = filteredSubmissions.map(sub => [
      sub.registration_id || '',
      sub.farmer_name,
      sub.contact_number,
      sub.bvn || '',
      sub.nin || '',
      sub.vin || '',
      sub.bank || '',
      sub.account_number || '',
      sub.account_name || '',
      sub.lga,
      sub.ward,
      sub.association,
      sub.membership_status || '',
      sub.executive_position || '',
      sub.number_of_animals,
      sub.geo_location || '',
      sub.created_date ? format(new Date(sub.created_date), 'yyyy-MM-dd') : ''
    ]);
    
    const csvContent = [headers, ...rows]
      .map(row => row.map(cell => `"${cell}"`).join(','))
      .join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `livestock_data_${format(new Date(), 'yyyy-MM-dd')}.csv`;
    link.click();

    await logAudit(
      'data_exported',
      'LivestockSubmission',
      `Exported ${filteredSubmissions.length} livestock records to CSV`,
      { record_count: filteredSubmissions.length, filters: { filterLGA, filterWard, filterAssociation } }
    );
  };

  const clearFilters = () => {
    setSearchTerm('');
    setFilterLGA('all');
    setFilterWard('all');
    setFilterAssociation('all');
    setDateFrom('');
    setDateTo('');
  };

  const totalAnimals = filteredSubmissions.reduce((sum, s) => sum + (s.number_of_animals || 0), 0);

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Data Management</h1>
          <p className="text-slate-500 mt-1">Filter, view, and export submissions</p>
        </div>
        <div className="flex gap-2">
          <Button variant="outline" onClick={() => refetch()}>
            <RefreshCw className="w-4 h-4 mr-2" />
            Refresh
          </Button>
          <Button onClick={exportToCSV} className="bg-emerald-600 hover:bg-emerald-700">
            <Download className="w-4 h-4 mr-2" />
            Export CSV
          </Button>
        </div>
      </div>

      {/* Filters Card */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <Filter className="w-5 h-5 text-emerald-600" />
            Filters
          </CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {/* Search */}
            <div className="space-y-2">
              <Label>Search</Label>
              <div className="relative">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                <Input
                  placeholder="Name, phone, Reg ID, NIN..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10"
                />
              </div>
            </div>

            {/* LGA Filter */}
            <div className="space-y-2">
              <Label>LGA</Label>
              <Select value={filterLGA} onValueChange={(v) => { setFilterLGA(v); setFilterWard('all'); }}>
                <SelectTrigger>
                  <SelectValue placeholder="All LGAs" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All LGAs</SelectItem>
                  {getLGAs().map((lga) => (
                    <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            {/* Ward Filter */}
            <div className="space-y-2">
              <Label>Ward</Label>
              <Select value={filterWard} onValueChange={setFilterWard} disabled={filterLGA === 'all'}>
                <SelectTrigger>
                  <SelectValue placeholder="All Wards" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Wards</SelectItem>
                  {filterLGA !== 'all' && getWards(filterLGA).map((ward) => (
                    <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            {/* Association Filter */}
            <div className="space-y-2">
              <Label>Association</Label>
              <Select value={filterAssociation} onValueChange={setFilterAssociation}>
                <SelectTrigger>
                  <SelectValue placeholder="All Associations" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Associations</SelectItem>
                  {ASSOCIATIONS.map((assoc) => (
                    <SelectItem key={assoc} value={assoc}>{assoc}</SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            {/* Date From */}
            <div className="space-y-2">
              <Label>From Date</Label>
              <Input
                type="date"
                value={dateFrom}
                onChange={(e) => setDateFrom(e.target.value)}
              />
            </div>

            {/* Date To */}
            <div className="space-y-2">
              <Label>To Date</Label>
              <Input
                type="date"
                value={dateTo}
                onChange={(e) => setDateTo(e.target.value)}
              />
            </div>

            {/* Clear Filters */}
            <div className="flex items-end">
              <Button variant="outline" onClick={clearFilters} className="w-full">
                Clear Filters
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Stats Summary */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-slate-900">{filteredSubmissions.length.toLocaleString()}</p>
            <p className="text-slate-500 text-sm">Records</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-emerald-600">{totalAnimals.toLocaleString()}</p>
            <p className="text-slate-500 text-sm">Total Animals</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-blue-600">
              {new Set(filteredSubmissions.map(s => s.lga)).size}
            </p>
            <p className="text-slate-500 text-sm">LGAs</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-purple-600">
              {new Set(filteredSubmissions.map(s => s.ward)).size}
            </p>
            <p className="text-slate-500 text-sm">Wards</p>
          </CardContent>
        </Card>
      </div>

      {/* Data Table */}
      <Card>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
              <p className="text-slate-500 mt-2">Loading data...</p>
            </div>
          ) : filteredSubmissions.length === 0 ? (
            <div className="p-8 text-center">
              <FileSpreadsheet className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No records found</p>
              <p className="text-slate-400 text-sm">Try adjusting your filters</p>
            </div>
          ) : (
            <div className="overflow-x-auto">
              <Table>
                <TableHeader>
                  <TableRow>
                    <TableHead>Farmer</TableHead>
                    <TableHead>Contact</TableHead>
                    <TableHead>Location</TableHead>
                    <TableHead>Association</TableHead>
                    <TableHead className="text-right">Animals</TableHead>
                    <TableHead>Date</TableHead>
                    <TableHead></TableHead>
                  </TableRow>
                </TableHeader>
                <TableBody>
                  {filteredSubmissions.slice(0, 100).map((sub) => (
                    <TableRow key={sub.id} className="hover:bg-slate-50">
                      <TableCell>
                        <div>
                          <p className="font-medium">{sub.farmer_name}</p>
                          {sub.nin && (
                            <p className="text-xs text-slate-400">NIN: {sub.nin}</p>
                          )}
                        </div>
                      </TableCell>
                      <TableCell>{sub.contact_number}</TableCell>
                      <TableCell>
                        <Badge variant="outline" className="text-xs">
                          {sub.ward}, {sub.lga}
                        </Badge>
                      </TableCell>
                      <TableCell className="max-w-[150px] truncate">
                        {sub.association}
                      </TableCell>
                      <TableCell className="text-right font-medium">
                        {sub.number_of_animals}
                      </TableCell>
                      <TableCell className="text-slate-500 text-sm">
                        {sub.created_date && format(new Date(sub.created_date), 'MMM d, yyyy')}
                      </TableCell>
                      <TableCell>
                        <Button 
                          variant="ghost" 
                          size="sm"
                          onClick={() => setSelectedSubmission(sub)}
                        >
                          <Eye className="w-4 h-4" />
                        </Button>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
              {filteredSubmissions.length > 100 && (
                <div className="p-4 text-center text-slate-500 text-sm border-t">
                  Showing first 100 of {filteredSubmissions.length} records. Export to see all.
                </div>
              )}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Detail Dialog */}
      <Dialog open={!!selectedSubmission} onOpenChange={() => setSelectedSubmission(null)}>
        <DialogContent className="max-w-lg">
          <DialogHeader>
            <DialogTitle>Submission Details</DialogTitle>
          </DialogHeader>
          {selectedSubmission && (
            <div className="space-y-6">
              {selectedSubmission.registration_id && (
                <div className="p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
                  <p className="text-emerald-700 text-xs font-medium mb-1">Registration ID</p>
                  <p className="text-emerald-900 font-mono font-bold text-lg">{selectedSubmission.registration_id}</p>
                </div>
              )}

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <User className="w-4 h-4" /> Farmer Information
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">Name</p>
                    <p className="font-medium">{selectedSubmission.farmer_name}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Phone</p>
                    <p className="font-medium">{selectedSubmission.contact_number}</p>
                  </div>
                  {selectedSubmission.bvn && (
                    <div>
                      <p className="text-slate-500">BVN</p>
                      <p className="font-medium">{selectedSubmission.bvn}</p>
                    </div>
                  )}
                  {selectedSubmission.nin && (
                    <div>
                      <p className="text-slate-500">NIN</p>
                      <p className="font-medium">{selectedSubmission.nin}</p>
                    </div>
                  )}
                  {selectedSubmission.bank && (
                    <div>
                      <p className="text-slate-500">Bank</p>
                      <p className="font-medium">{selectedSubmission.bank}</p>
                    </div>
                  )}
                  {selectedSubmission.account_number && (
                    <div>
                      <p className="text-slate-500">Account</p>
                      <p className="font-medium">{selectedSubmission.account_number}</p>
                    </div>
                  )}
                </div>
              </div>

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <MapPin className="w-4 h-4" /> Location
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">LGA</p>
                    <p className="font-medium">{selectedSubmission.lga}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Ward</p>
                    <p className="font-medium">{selectedSubmission.ward}</p>
                  </div>
                </div>
              </div>

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <Building className="w-4 h-4" /> Association
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">Type</p>
                    <p className="font-medium">{selectedSubmission.association}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Animals</p>
                    <p className="font-medium text-emerald-600 text-lg">{selectedSubmission.number_of_animals}</p>
                  </div>
                  {selectedSubmission.membership_status && (
                    <div>
                      <p className="text-slate-500">Membership</p>
                      <p className="font-medium capitalize">{selectedSubmission.membership_status.replace('_', ' ')}</p>
                    </div>
                  )}
                  {selectedSubmission.executive_position && (
                    <div>
                      <p className="text-slate-500">Position</p>
                      <p className="font-medium">{selectedSubmission.executive_position}</p>
                    </div>
                  )}
                </div>
              </div>

              {selectedSubmission.geo_location && (
                <div className="space-y-3">
                  <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                    <Navigation className="w-4 h-4" /> GPS Location
                  </h4>
                  <div className="bg-emerald-50 p-3 rounded-lg">
                    <p className="text-emerald-900 font-mono text-sm">{selectedSubmission.geo_location}</p>
                    <a 
                      href={`https://www.google.com/maps?q=${selectedSubmission.geo_location}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-emerald-600 text-xs hover:underline mt-1 inline-block"
                    >
                      View on Google Maps 
                    </a>
                  </div>
                </div>
              )}

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <Calendar className="w-4 h-4" /> Metadata
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">Submitted</p>
                    <p className="font-medium">
                      {selectedSubmission.created_date && format(new Date(selectedSubmission.created_date), 'PPp')}
                    </p>
                  </div>
                  <div>
                    <p className="text-slate-500">Agent</p>
                    <p className="font-medium">{selectedSubmission.agent_name || 'N/A'}</p>
                  </div>
                </div>
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}


distrubution DataManagement

import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  Package,
  Users,
  CheckCircle2,
  XCircle,
  Plus,
  Search,
  FileText,
  Download,
  RefreshCw,
  Eye
} from 'lucide-react';
import { format } from 'date-fns';
import { getLGAs, getWards } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function DistributionManagement() {
  const queryClient = useQueryClient();
  const [showAllocateDialog, setShowAllocateDialog] = useState(false);
  const [selectedLGA, setSelectedLGA] = useState('');
  const [selectedWard, setSelectedWard] = useState('');
  const [searchTerm, setSearchTerm] = useState('');
  const [filterCollected, setFilterCollected] = useState('all');
  const [selectedDistribution, setSelectedDistribution] = useState(null);
  
  const [allocationData, setAllocationData] = useState({
    resource_type: '',
    resource_description: '',
    quantity: 1,
    notes: ''
  });

  const { data: submissions = [], isLoading: submissionsLoading } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list('-created_date'),
  });

  const { data: distributions = [], isLoading: distributionsLoading } = useQuery({
    queryKey: ['distributions'],
    queryFn: () => base44.entities.Distribution.list('-created_date'),
  });

  const { data: currentUser } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const createDistributionMutation = useMutation({
    mutationFn: (data) => base44.entities.Distribution.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['distributions'] });
      setShowAllocateDialog(false);
      setAllocationData({ resource_type: '', resource_description: '', quantity: 1, notes: '' });
    },
  });

  const filteredBeneficiaries = submissions.filter(sub => {
    const matchesLGA = !selectedLGA || sub.lga === selectedLGA;
    const matchesWard = !selectedWard || sub.ward === selectedWard;
    const matchesSearch = !searchTerm || 
      sub.farmer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.registration_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.contact_number?.includes(searchTerm);
    
    return matchesLGA && matchesWard && matchesSearch;
  });

  const filteredDistributions = distributions.filter(dist => {
    const matchesCollected = filterCollected === 'all' || 
      (filterCollected === 'collected' && dist.collected) ||
      (filterCollected === 'pending' && !dist.collected);
    return matchesCollected;
  });

  const handleAllocate = async (beneficiary) => {
    const distData = {
      beneficiary_id: beneficiary.id,
      registration_id: beneficiary.registration_id,
      beneficiary_name: beneficiary.farmer_name,
      beneficiary_phone: beneficiary.contact_number,
      lga: beneficiary.lga,
      ward: beneficiary.ward,
      ...allocationData,
      allocated_by: currentUser?.full_name || currentUser?.email,
      allocated_date: new Date().toISOString(),
    };

    await createDistributionMutation.mutateAsync(distData);
    await logAudit(
      'bulk_action',
      'Distribution',
      `Allocated ${allocationData.resource_type} to ${beneficiary.farmer_name}`,
      { beneficiary_id: beneficiary.id, resource_type: allocationData.resource_type }
    );
  };

  const handleBulkAllocate = async () => {
    for (const beneficiary of filteredBeneficiaries) {
      await handleAllocate(beneficiary);
    }
    alert(`Successfully allocated to ${filteredBeneficiaries.length} beneficiaries`);
  };

  const handlePrintAllocation = (distribution) => {
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Allocation Record - ${distribution.registration_id}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
          .header { text-align: center; border-bottom: 2px solid #10b981; padding-bottom: 20px; margin-bottom: 30px; }
          .header h1 { color: #10b981; margin: 0; }
          .section { margin: 20px 0; }
          .section h3 { color: #334155; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
          .info-grid { display: grid; grid-template-columns: 200px 1fr; gap: 10px; margin: 10px 0; }
          .label { font-weight: bold; color: #64748b; }
          .value { color: #0f172a; }
          .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; text-align: center; color: #64748b; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>Jigawa State Ministry of Livestock Development</h1>
          <p>Distribution/Allocation Record</p>
        </div>
        
        <div class="section">
          <h3>Beneficiary Information</h3>
          <div class="info-grid">
            <div class="label">Registration ID:</div>
            <div class="value">${distribution.registration_id}</div>
            <div class="label">Name:</div>
            <div class="value">${distribution.beneficiary_name}</div>
            <div class="label">Phone:</div>
            <div class="value">${distribution.beneficiary_phone || 'N/A'}</div>
            <div class="label">Location:</div>
            <div class="value">${distribution.ward}, ${distribution.lga}</div>
          </div>
        </div>

        <div class="section">
          <h3>Resource Allocation</h3>
          <div class="info-grid">
            <div class="label">Resource Type:</div>
            <div class="value">${distribution.resource_type}</div>
            <div class="label">Description:</div>
            <div class="value">${distribution.resource_description || 'N/A'}</div>
            <div class="label">Quantity:</div>
            <div class="value">${distribution.quantity}</div>
          </div>
        </div>

        <div class="section">
          <h3>Allocation Details</h3>
          <div class="info-grid">
            <div class="label">Allocated By:</div>
            <div class="value">${distribution.allocated_by}</div>
            <div class="label">Allocated Date:</div>
            <div class="value">${format(new Date(distribution.allocated_date), 'PPP')}</div>
            <div class="label">Status:</div>
            <div class="value">${distribution.collected ? 'Collected' : 'Pending Collection'}</div>
            ${distribution.collected ? `
              <div class="label">Collected Date:</div>
              <div class="value">${format(new Date(distribution.collected_date), 'PPP')}</div>
              <div class="label">Confirmed By:</div>
              <div class="value">${distribution.collected_by_agent || 'N/A'}</div>
            ` : ''}
          </div>
        </div>

        <div class="footer">
          <p>Generated on ${format(new Date(), 'PPP')}</p>
        </div>
      </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.print();
  };

  const collectedCount = distributions.filter(d => d.collected).length;
  const pendingCount = distributions.filter(d => !d.collected).length;

  return (
    <div className="space-y-6">
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Distribution Management</h1>
          <p className="text-slate-500 mt-1">Allocate and track resource distribution</p>
        </div>
        <Button onClick={() => setShowAllocateDialog(true)} className="bg-emerald-600 hover:bg-emerald-700">
          <Plus className="w-4 h-4 mr-2" />
          New Allocation
        </Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-6 text-center">
            <Package className="w-8 h-8 text-emerald-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{distributions.length}</p>
            <p className="text-slate-500 text-sm">Total Allocations</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-6 text-center">
            <CheckCircle2 className="w-8 h-8 text-green-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{collectedCount}</p>
            <p className="text-slate-500 text-sm">Collected</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-6 text-center">
            <XCircle className="w-8 h-8 text-amber-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{pendingCount}</p>
            <p className="text-slate-500 text-sm">Pending Collection</p>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader className="border-b">
          <CardTitle>Distribution Records</CardTitle>
        </CardHeader>
        <CardContent className="p-4">
          <div className="flex gap-4 mb-4">
            <Select value={filterCollected} onValueChange={setFilterCollected}>
              <SelectTrigger className="w-48">
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="all">All Status</SelectItem>
                <SelectItem value="collected">Collected</SelectItem>
                <SelectItem value="pending">Pending</SelectItem>
              </SelectContent>
            </Select>
          </div>

          {distributionsLoading ? (
            <div className="text-center py-8">
              <RefreshCw className="w-8 h-8 animate-spin text-slate-400 mx-auto" />
            </div>
          ) : filteredDistributions.length === 0 ? (
            <div className="text-center py-8">
              <Package className="w-12 h-12 text-slate-300 mx-auto mb-2" />
              <p className="text-slate-500">No distributions found</p>
            </div>
          ) : (
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Reg ID</TableHead>
                  <TableHead>Beneficiary</TableHead>
                  <TableHead>Resource</TableHead>
                  <TableHead>Location</TableHead>
                  <TableHead>Status</TableHead>
                  <TableHead>Actions</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {filteredDistributions.map((dist) => (
                  <TableRow key={dist.id}>
                    <TableCell className="font-mono text-sm">{dist.registration_id}</TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium">{dist.beneficiary_name}</p>
                        <p className="text-sm text-slate-500">{dist.beneficiary_phone}</p>
                      </div>
                    </TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium">{dist.resource_type}</p>
                        <p className="text-sm text-slate-500">Qty: {dist.quantity}</p>
                      </div>
                    </TableCell>
                    <TableCell>
                      <Badge variant="outline">{dist.ward}, {dist.lga}</Badge>
                    </TableCell>
                    <TableCell>
                      {dist.collected ? (
                        <Badge className="bg-green-100 text-green-700">Collected</Badge>
                      ) : (
                        <Badge className="bg-amber-100 text-amber-700">Pending</Badge>
                      )}
                    </TableCell>
                    <TableCell>
                      <div className="flex gap-2">
                        <Button variant="ghost" size="sm" onClick={() => setSelectedDistribution(dist)}>
                          <Eye className="w-4 h-4" />
                        </Button>
                        <Button variant="ghost" size="sm" onClick={() => handlePrintAllocation(dist)}>
                          <FileText className="w-4 h-4" />
                        </Button>
                      </div>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          )}
        </CardContent>
      </Card>

      <Dialog open={showAllocateDialog} onOpenChange={setShowAllocateDialog}>
        <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
          <DialogHeader>
            <DialogTitle>Allocate Resources</DialogTitle>
          </DialogHeader>
          
          <div className="space-y-6">
            <Card className="bg-slate-50">
              <CardContent className="p-4">
                <h3 className="font-semibold mb-4">Resource Details</h3>
                <div className="space-y-4">
                  <div>
                    <Label>Resource Type *</Label>
                    <Input
                      placeholder="e.g., Animal Feed, Vaccine, Equipment"
                      value={allocationData.resource_type}
                      onChange={(e) => setAllocationData({...allocationData, resource_type: e.target.value})}
                    />
                  </div>
                  <div>
                    <Label>Description</Label>
                    <Textarea
                      placeholder="Detailed description"
                      value={allocationData.resource_description}
                      onChange={(e) => setAllocationData({...allocationData, resource_description: e.target.value})}
                      rows={2}
                    />
                  </div>
                  <div>
                    <Label>Quantity</Label>
                    <Input
                      type="number"
                      min="1"
                      value={allocationData.quantity}
                      onChange={(e) => setAllocationData({...allocationData, quantity: parseInt(e.target.value)})}
                    />
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader className="border-b">
                <CardTitle>Select Beneficiaries</CardTitle>
              </CardHeader>
              <CardContent className="p-4">
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                  <div>
                    <Label>LGA</Label>
                    <Select value={selectedLGA} onValueChange={(v) => { setSelectedLGA(v); setSelectedWard(''); }}>
                      <SelectTrigger>
                        <SelectValue placeholder="All LGAs" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value={null}>All LGAs</SelectItem>
                        {getLGAs().map((lga) => (
                          <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Ward</Label>
                    <Select value={selectedWard} onValueChange={setSelectedWard} disabled={!selectedLGA}>
                      <SelectTrigger>
                        <SelectValue placeholder="All Wards" />
                      </SelectTrigger>
                      <SelectContent>
                        <SelectItem value={null}>All Wards</SelectItem>
                        {selectedLGA && getWards(selectedLGA).map((ward) => (
                          <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                  </div>
                  <div>
                    <Label>Search</Label>
                    <div className="relative">
                      <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                      <Input
                        placeholder="Name or Reg ID"
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="pl-10"
                      />
                    </div>
                  </div>
                </div>

                <div className="flex justify-between items-center mb-4">
                  <p className="text-sm text-slate-600">{filteredBeneficiaries.length} beneficiaries found</p>
                  <Button
                    onClick={handleBulkAllocate}
                    disabled={filteredBeneficiaries.length === 0 || !allocationData.resource_type}
                    size="sm"
                  >
                    Allocate to All ({filteredBeneficiaries.length})
                  </Button>
                </div>

                <div className="max-h-64 overflow-y-auto border rounded-lg">
                  <Table>
                    <TableHeader>
                      <TableRow>
                        <TableHead>Reg ID</TableHead>
                        <TableHead>Name</TableHead>
                        <TableHead>Location</TableHead>
                        <TableHead>Action</TableHead>
                      </TableRow>
                    </TableHeader>
                    <TableBody>
                      {filteredBeneficiaries.slice(0, 50).map((beneficiary) => (
                        <TableRow key={beneficiary.id}>
                          <TableCell className="font-mono text-xs">{beneficiary.registration_id}</TableCell>
                          <TableCell>{beneficiary.farmer_name}</TableCell>
                          <TableCell className="text-sm">{beneficiary.ward}, {beneficiary.lga}</TableCell>
                          <TableCell>
                            <Button
                              size="sm"
                              variant="outline"
                              onClick={() => handleAllocate(beneficiary)}
                              disabled={!allocationData.resource_type}
                            >
                              Allocate
                            </Button>
                          </TableCell>
                        </TableRow>
                      ))}
                    </TableBody>
                  </Table>
                </div>
              </CardContent>
            </Card>
          </div>
        </DialogContent>
      </Dialog>

      <Dialog open={!!selectedDistribution} onOpenChange={() => setSelectedDistribution(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Distribution Details</DialogTitle>
          </DialogHeader>
          {selectedDistribution && (
            <div className="space-y-4">
              <div>
                <Label className="text-slate-500">Registration ID</Label>
                <p className="font-mono font-bold">{selectedDistribution.registration_id}</p>
              </div>
              <div>
                <Label className="text-slate-500">Beneficiary</Label>
                <p className="font-medium">{selectedDistribution.beneficiary_name}</p>
                <p className="text-sm text-slate-500">{selectedDistribution.beneficiary_phone}</p>
              </div>
              <div>
                <Label className="text-slate-500">Resource</Label>
                <p className="font-medium">{selectedDistribution.resource_type}</p>
                <p className="text-sm text-slate-500">{selectedDistribution.resource_description}</p>
              </div>
              <div>
                <Label className="text-slate-500">Allocated By</Label>
                <p>{selectedDistribution.allocated_by}</p>
                <p className="text-sm text-slate-500">
                  {format(new Date(selectedDistribution.allocated_date), 'PPP')}
                </p>
              </div>
              <div>
                <Label className="text-slate-500">Status</Label>
                {selectedDistribution.collected ? (
                  <div>
                    <Badge className="bg-green-100 text-green-700">Collected</Badge>
                    <p className="text-sm text-slate-500 mt-1">
                      Collected on {format(new Date(selectedDistribution.collected_date), 'PPP')}
                    </p>
                    <p className="text-sm text-slate-500">By: {selectedDistribution.collected_by_agent}</p>
                  </div>
                ) : (
                  <Badge className="bg-amber-100 text-amber-700">Pending Collection</Badge>
                )}
              </div>
              <Button onClick={() => handlePrintAllocation(selectedDistribution)} className="w-full">
                <FileText className="w-4 h-4 mr-2" />
                Print Allocation Record
              </Button>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}


distrubution tracking


import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  Search,
  Package,
  CheckCircle2,
  AlertCircle,
  RefreshCw
} from 'lucide-react';
import { format } from 'date-fns';
import { logAudit } from '@/components/utils/auditLogger';

export default function DistributionTracking() {
  const queryClient = useQueryClient();
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedDistribution, setSelectedDistribution] = useState(null);

  const { data: currentUser } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: distributions = [], isLoading } = useQuery({
    queryKey: ['agentDistributions'],
    queryFn: () => base44.entities.Distribution.list('-created_date'),
  });

  const confirmCollectionMutation = useMutation({
    mutationFn: ({ id, data }) => base44.entities.Distribution.update(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['agentDistributions'] });
      setSelectedDistribution(null);
    },
  });

  const handleConfirmCollection = async (distribution) => {
    const updateData = {
      collected: true,
      collected_date: new Date().toISOString(),
      collected_by_agent: currentUser?.full_name || currentUser?.email,
    };

    await confirmCollectionMutation.mutateAsync({ id: distribution.id, data: updateData });
    await logAudit(
      'bulk_action',
      'Distribution',
      `Confirmed collection for ${distribution.beneficiary_name}`,
      { distribution_id: distribution.id, registration_id: distribution.registration_id }
    );
  };

  const filteredDistributions = distributions.filter(dist => {
    if (!searchTerm) return true;
    return (
      dist.registration_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      dist.beneficiary_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      dist.beneficiary_phone?.includes(searchTerm)
    );
  });

  const collectedCount = distributions.filter(d => d.collected).length;
  const pendingCount = distributions.filter(d => !d.collected).length;

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-slate-900">Distribution Tracking</h1>
        <p className="text-slate-500 mt-1">Track and confirm resource collection</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-6 text-center">
            <Package className="w-8 h-8 text-emerald-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{distributions.length}</p>
            <p className="text-slate-500 text-sm">Total Allocations</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-6 text-center">
            <CheckCircle2 className="w-8 h-8 text-green-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{collectedCount}</p>
            <p className="text-slate-500 text-sm">Collected</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-6 text-center">
            <AlertCircle className="w-8 h-8 text-amber-600 mx-auto mb-2" />
            <p className="text-2xl font-bold text-slate-900">{pendingCount}</p>
            <p className="text-slate-500 text-sm">Pending Collection</p>
          </CardContent>
        </Card>
      </div>

      <Card>
        <CardHeader className="border-b">
          <CardTitle>Search Beneficiary</CardTitle>
        </CardHeader>
        <CardContent className="p-4">
          <div className="relative mb-4">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
            <Input
              placeholder="Search by Registration ID, Name, or Phone"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-10"
            />
          </div>

          {isLoading ? (
            <div className="text-center py-8">
              <RefreshCw className="w-8 h-8 animate-spin text-slate-400 mx-auto" />
            </div>
          ) : filteredDistributions.length === 0 ? (
            <div className="text-center py-8">
              <Package className="w-12 h-12 text-slate-300 mx-auto mb-2" />
              <p className="text-slate-500">No distributions found</p>
            </div>
          ) : (
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead>Reg ID</TableHead>
                  <TableHead>Beneficiary</TableHead>
                  <TableHead>Resource</TableHead>
                  <TableHead>Status</TableHead>
                  <TableHead>Action</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {filteredDistributions.map((dist) => (
                  <TableRow key={dist.id}>
                    <TableCell className="font-mono text-sm">{dist.registration_id}</TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium">{dist.beneficiary_name}</p>
                        <p className="text-sm text-slate-500">{dist.beneficiary_phone}</p>
                      </div>
                    </TableCell>
                    <TableCell>
                      <div>
                        <p className="font-medium">{dist.resource_type}</p>
                        <p className="text-sm text-slate-500">Qty: {dist.quantity}</p>
                      </div>
                    </TableCell>
                    <TableCell>
                      {dist.collected ? (
                        <Badge className="bg-green-100 text-green-700">
                          <CheckCircle2 className="w-3 h-3 mr-1" />
                          Collected
                        </Badge>
                      ) : (
                        <Badge className="bg-amber-100 text-amber-700">
                          <AlertCircle className="w-3 h-3 mr-1" />
                          Pending
                        </Badge>
                      )}
                    </TableCell>
                    <TableCell>
                      {!dist.collected ? (
                        <Button
                          size="sm"
                          onClick={() => setSelectedDistribution(dist)}
                          className="bg-emerald-600 hover:bg-emerald-700"
                        >
                          Confirm Collection
                        </Button>
                      ) : (
                        <span className="text-sm text-slate-500">
                          {format(new Date(dist.collected_date), 'MMM d, yyyy')}
                        </span>
                      )}
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          )}
        </CardContent>
      </Card>

      <Dialog open={!!selectedDistribution} onOpenChange={() => setSelectedDistribution(null)}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Confirm Collection</DialogTitle>
          </DialogHeader>
          {selectedDistribution && (
            <div className="space-y-4">
              <Card className="bg-emerald-50 border-emerald-200">
                <CardContent className="p-4">
                  <p className="text-emerald-700 text-sm font-medium">Registration ID</p>
                  <p className="text-emerald-900 font-mono font-bold text-lg">
                    {selectedDistribution.registration_id}
                  </p>
                </CardContent>
              </Card>

              <div>
                <p className="text-slate-500 text-sm">Beneficiary</p>
                <p className="font-medium text-lg">{selectedDistribution.beneficiary_name}</p>
                <p className="text-slate-500">{selectedDistribution.beneficiary_phone}</p>
              </div>

              <div>
                <p className="text-slate-500 text-sm">Resource</p>
                <p className="font-medium">{selectedDistribution.resource_type}</p>
                <p className="text-slate-500 text-sm">{selectedDistribution.resource_description}</p>
                <p className="text-sm mt-1">Quantity: <span className="font-medium">{selectedDistribution.quantity}</span></p>
              </div>

              <div className="pt-4 border-t">
                <p className="text-sm text-slate-600 mb-4">
                  Confirm that this beneficiary has received the allocated resource
                </p>
                <Button
                  onClick={() => handleConfirmCollection(selectedDistribution)}
                  className="w-full bg-emerald-600 hover:bg-emerald-700"
                >
                  <CheckCircle2 className="w-4 h-4 mr-2" />
                  Confirm Collection
                </Button>
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}


HTMLModElement

import React from 'react';
import { Link } from 'react-router-dom';
import { createPageUrl } from '@/utils';
import { motion } from 'framer-motion';
import { Button } from '@/components/ui/button';
import { 
  Building2, 
  ChevronRight, 
  Shield, 
  Database, 
  Users, 
  BarChart3,
  Smartphone,
  Cloud,
  CheckCircle2
} from 'lucide-react';

export default function Home() {
  const features = [
    {
      icon: Database,
      title: "Centralized Data",
      description: "All livestock data from 287 wards collected and stored securely in one place"
    },
    {
      icon: Smartphone,
      title: "Offline-First",
      description: "Collect data even without internet. Sync automatically when connected"
    },
    {
      icon: Shield,
      title: "Secure & Compliant",
      description: "Government-grade security compliant with Nigeria Data Protection Act"
    },
    {
      icon: BarChart3,
      title: "Real-time Analytics",
      description: "Monitor submissions, track progress, and generate reports instantly"
    }
  ];

  const benefits = [
    "Policy planning and resource allocation",
    "Transparent livestock registry",
    "Funding and intervention targeting",
    "Agricultural development insights"
  ];

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-emerald-950 to-slate-900">
      {/* Hero Section */}
      <header className="relative overflow-hidden">
        {/* Background Pattern */}
        <div className="absolute inset-0 opacity-20">
          <div className="absolute top-0 left-1/4 w-96 h-96 bg-emerald-500 rounded-full blur-3xl" />
          <div className="absolute bottom-0 right-1/4 w-96 h-96 bg-emerald-400 rounded-full blur-3xl" />
        </div>

        <div className="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 pb-20">
          {/* Top Bar */}
          <nav className="flex items-center justify-between mb-16">
            <div className="flex items-center gap-3">
              <div className="w-12 h-12 bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-2xl flex items-center justify-center shadow-xl shadow-emerald-500/30">
                <Building2 className="w-6 h-6 text-white" />
              </div>
              <div>
                <h1 className="font-bold text-white text-sm leading-tight">Ministry of Livestock</h1>
                <p className="text-emerald-300/70 text-xs">Jigawa State</p>
              </div>
            </div>
            <Link to={createPageUrl('AgentDashboard')}>
              <Button className="bg-white/10 backdrop-blur-lg border border-white/20 text-white hover:bg-white/20">
                Sign In
              </Button>
            </Link>
          </nav>

          {/* Hero Content */}
          <div className="text-center max-w-4xl mx-auto">
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6 }}
            >
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20 text-emerald-300 text-sm mb-8">
                <span className="w-2 h-2 bg-emerald-400 rounded-full animate-pulse" />
                Official Government Platform
              </div>
              
              <h1 className="text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight">
                Jigawa State Ministry of
                <span className="block text-transparent bg-clip-text bg-gradient-to-r from-emerald-300 to-emerald-500">
                  Livestock Development
                </span>
              </h1>
              
              <p className="text-lg sm:text-xl text-slate-300 mb-10 max-w-2xl mx-auto leading-relaxed">
                A secure, offline-first data collection system for livestock associations 
                across all 27 LGAs and 287 wards of Jigawa State.
              </p>

              <div className="flex flex-col sm:flex-row gap-4 justify-center">
                <Link to={createPageUrl('AgentDashboard')}>
                  <Button size="lg" className="bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-6 text-lg rounded-xl shadow-xl shadow-emerald-500/30">
                    Proceed to Login
                    <ChevronRight className="w-5 h-5 ml-2" />
                  </Button>
                </Link>
              </div>
            </motion.div>
          </div>

          {/* Stats */}
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.6, delay: 0.3 }}
            className="grid grid-cols-3 gap-4 sm:gap-8 max-w-3xl mx-auto mt-16"
          >
            {[
              { value: "27", label: "LGAs" },
              { value: "287", label: "Wards" },
              { value: "21", label: "Associations" }
            ].map((stat) => (
              <div key={stat.label} className="text-center p-4 sm:p-6 rounded-2xl bg-white/5 backdrop-blur-lg border border-white/10">
                <div className="text-3xl sm:text-4xl font-bold text-emerald-400">{stat.value}</div>
                <div className="text-slate-400 text-sm mt-1">{stat.label}</div>
              </div>
            ))}
          </motion.div>
        </div>
      </header>

      {/* Features Section */}
      <section className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-16">
            <h2 className="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">
              Purpose & Benefits
            </h2>
            <p className="text-slate-600 max-w-2xl mx-auto">
              The centralized data initiative enables the Ministry to collect, manage, 
              and analyze livestock data for better governance and development planning.
            </p>
          </div>

          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {features.map((feature, index) => (
              <motion.div
                key={feature.title}
                initial={{ opacity: 0, y: 20 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                viewport={{ once: true }}
                className="p-6 rounded-2xl bg-slate-50 hover:bg-emerald-50 border border-slate-100 hover:border-emerald-100 transition-all duration-300 group"
              >
                <div className="w-12 h-12 rounded-xl bg-emerald-100 text-emerald-600 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                  <feature.icon className="w-6 h-6" />
                </div>
                <h3 className="font-semibold text-slate-900 mb-2">{feature.title}</h3>
                <p className="text-slate-600 text-sm leading-relaxed">{feature.description}</p>
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Leadership Section */}
      <section className="py-20 bg-gradient-to-br from-slate-50 to-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="text-center mb-12">
            <h2 className="text-3xl sm:text-4xl font-bold text-slate-900 mb-4">
              Our Leadership
            </h2>
            <p className="text-slate-600 max-w-2xl mx-auto">
              Under the visionary leadership of our government officials
            </p>
          </div>

          <div className="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
            {/* Governor */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5 }}
              viewport={{ once: true }}
              className="bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100 hover:shadow-xl transition-all duration-300"
            >
              <div className="aspect-[4/5] relative bg-gradient-to-br from-emerald-50 to-white overflow-hidden">
                <img 
                  src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6945e7035c490d969f7c27d6/72a6157ad_HisExcellencyMalUmarNamadiDanmodiCONtheGovernorofJigawaState.png"
                  alt="His Excellency, Malam Umar Namadi Danmodi, CON"
                  className="w-full h-full object-cover"
                />
              </div>
              <div className="p-6 text-center">
                <div className="inline-block px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium mb-3">
                  Executive Governor
                </div>
                <h3 className="text-xl font-bold text-slate-900 mb-1">
                  His Excellency, Malam Umar Namadi Danmodi, CON
                </h3>
                <p className="text-slate-600">
                  Executive Governor of Jigawa State
                </p>
              </div>
            </motion.div>

            {/* Commissioner */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              whileInView={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5, delay: 0.1 }}
              viewport={{ once: true }}
              className="bg-white rounded-2xl shadow-lg overflow-hidden border border-slate-100 hover:shadow-xl transition-all duration-300"
            >
              <div className="aspect-[4/5] relative bg-gradient-to-br from-emerald-50 to-white overflow-hidden">
                <img 
                  src="https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/6945e7035c490d969f7c27d6/6ba786df1_CommissionerJigawaStateMinistryofLivestockDevelopmentHonProfSalimAbdurahamanLawan.png"
                  alt="Hon. Prof. Salim Abdurrahman Lawan"
                  className="w-full h-full object-cover"
                />
              </div>
              <div className="p-6 text-center">
                <div className="inline-block px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-xs font-medium mb-3">
                  Commissioner
                </div>
                <h3 className="text-xl font-bold text-slate-900 mb-1">
                  Hon. Commissioner Salim Abdurrahman Lawan
                </h3>
                <p className="text-slate-600">
                  Commissioner, Ministry of Livestock Development
                </p>
              </div>
            </motion.div>
          </div>
        </div>
      </section>

      {/* Benefits Section */}
      <section className="py-20 bg-white">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="grid lg:grid-cols-2 gap-12 items-center">
            <div>
              <h2 className="text-3xl sm:text-4xl font-bold text-slate-900 mb-6">
                Building a Transparent <span className="text-emerald-600">Livestock Registry</span>
              </h2>
              <p className="text-slate-600 mb-8 leading-relaxed">
                This initiative supports the Jigawa State Ministry of Livestock Development 
                in creating a comprehensive database of all livestock associations and farmers 
                across the state.
              </p>
              <ul className="space-y-4">
                {benefits.map((benefit) => (
                  <li key={benefit} className="flex items-center gap-3">
                    <div className="w-6 h-6 rounded-full bg-emerald-100 flex items-center justify-center flex-shrink-0">
                      <CheckCircle2 className="w-4 h-4 text-emerald-600" />
                    </div>
                    <span className="text-slate-700">{benefit}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div className="relative">
              <div className="aspect-square rounded-3xl bg-gradient-to-br from-emerald-500 to-emerald-700 p-1">
                <div className="w-full h-full rounded-3xl bg-white flex items-center justify-center">
                  <div className="text-center p-8">
                    <div className="w-20 h-20 mx-auto mb-6 bg-emerald-50 rounded-2xl flex items-center justify-center">
                      <Users className="w-10 h-10 text-emerald-600" />
                    </div>
                    <h3 className="text-xl font-bold text-slate-900 mb-2">Ward Agents</h3>
                    <p className="text-slate-600 text-sm">
                      One dedicated agent per ward ensuring comprehensive data coverage
                    </p>
                  </div>
                </div>
              </div>
              <div className="absolute -bottom-4 -right-4 w-24 h-24 bg-emerald-200 rounded-2xl -z-10" />
            </div>
          </div>
        </div>
      </section>

      {/* Footer CTA */}
      <section className="py-20 bg-gradient-to-br from-emerald-600 to-emerald-800">
        <div className="max-w-4xl mx-auto px-4 text-center">
          <h2 className="text-3xl sm:text-4xl font-bold text-white mb-6">
            Ready to Get Started?
          </h2>
          <p className="text-emerald-100 mb-8 text-lg">
            Login to access your dashboard and start collecting or managing livestock data.
          </p>
          <Link to={createPageUrl('AgentDashboard')}>
            <Button size="lg" className="bg-white text-emerald-700 hover:bg-emerald-50 px-8 py-6 text-lg rounded-xl">
              Proceed to Login
              <ChevronRight className="w-5 h-5 ml-2" />
            </Button>
          </Link>
        </div>
      </section>

      {/* Footer */}
      <footer className="bg-slate-900 py-8">
        <div className="max-w-7xl mx-auto px-4 text-center">
          <div className="flex items-center justify-center gap-3 mb-4">
            <div className="w-10 h-10 bg-emerald-600 rounded-xl flex items-center justify-center">
              <Building2 className="w-5 h-5 text-white" />
            </div>
            <div className="text-left">
              <p className="font-semibold text-white text-sm">Ministry of Livestock</p>
              <p className="text-slate-400 text-xs">Jigawa State</p>
            </div>
          </div>
          <p className="text-slate-500 text-sm">
             {new Date().getFullYear()} Jigawa State Government. All rights reserved.
          </p>
        </div>
      </footer>
    </div>
  );
}


idcard generator



import React, { useState, useRef } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import {
  Search,
  CreditCard,
  RefreshCw,
  Download,
  User,
  MapPin,
  Phone
} from 'lucide-react';
import html2canvas from 'html2canvas';

export default function IDCardGenerator() {
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedBeneficiary, setSelectedBeneficiary] = useState(null);
  const cardRef = useRef(null);

  const { data: submissions = [], isLoading } = useQuery({
    queryKey: ['allSubmissions'],
    queryFn: () => base44.entities.LivestockSubmission.list('-created_date'),
  });

  const filteredSubmissions = submissions.filter(sub => {
    if (!searchTerm) return false;
    return (
      sub.registration_id?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.farmer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.contact_number?.includes(searchTerm)
    );
  });

  const handleGenerateCard = async () => {
    if (!cardRef.current) return;
    
    const canvas = await html2canvas(cardRef.current, {
      scale: 2,
      backgroundColor: '#ffffff'
    });
    
    const link = document.createElement('a');
    link.download = `ID_Card_${selectedBeneficiary.registration_id}.png`;
    link.href = canvas.toDataURL();
    link.click();
  };

  const handlePrintCard = async () => {
    if (!cardRef.current) return;
    
    const canvas = await html2canvas(cardRef.current, {
      scale: 2,
      backgroundColor: '#ffffff'
    });
    
    const imgData = canvas.toDataURL('image/png');
    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>ID Card - ${selectedBeneficiary.registration_id}</title>
        <style>
          body { margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
          img { max-width: 100%; height: auto; }
        </style>
      </head>
      <body>
        <img src="${imgData}" />
      </body>
      </html>
    `);
    printWindow.document.close();
    printWindow.print();
  };

  return (
    <div className="space-y-6 max-w-5xl mx-auto">
      <div>
        <h1 className="text-2xl font-bold text-slate-900">ID Card Generator</h1>
        <p className="text-slate-500 mt-1">Generate and print beneficiary ID cards</p>
      </div>

      <Card>
        <CardHeader className="border-b">
          <CardTitle>Search Beneficiary</CardTitle>
        </CardHeader>
        <CardContent className="p-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
            <Input
              placeholder="Search by Registration ID, Name, or Phone"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-10"
            />
          </div>

          {searchTerm && (
            <div className="mt-4 max-h-64 overflow-y-auto">
              {isLoading ? (
                <div className="text-center py-8">
                  <RefreshCw className="w-8 h-8 animate-spin text-slate-400 mx-auto" />
                </div>
              ) : filteredSubmissions.length === 0 ? (
                <p className="text-slate-500 text-center py-4">No beneficiaries found</p>
              ) : (
                <div className="space-y-2">
                  {filteredSubmissions.slice(0, 10).map((sub) => (
                    <Card
                      key={sub.id}
                      className={`cursor-pointer hover:bg-slate-50 transition-colors ${
                        selectedBeneficiary?.id === sub.id ? 'border-emerald-500 bg-emerald-50' : ''
                      }`}
                      onClick={() => setSelectedBeneficiary(sub)}
                    >
                      <CardContent className="p-4">
                        <div className="flex items-center justify-between">
                          <div>
                            <p className="font-medium">{sub.farmer_name}</p>
                            <p className="text-sm text-slate-500 font-mono">{sub.registration_id}</p>
                          </div>
                          <Badge variant="outline">{sub.lga}</Badge>
                        </div>
                      </CardContent>
                    </Card>
                  ))}
                </div>
              )}
            </div>
          )}
        </CardContent>
      </Card>

      {selectedBeneficiary && (
        <>
          <Card>
            <CardHeader className="border-b flex flex-row items-center justify-between">
              <CardTitle>ID Card Preview</CardTitle>
              <div className="flex gap-2">
                <Button variant="outline" onClick={handleGenerateCard}>
                  <Download className="w-4 h-4 mr-2" />
                  Download
                </Button>
                <Button onClick={handlePrintCard} className="bg-emerald-600 hover:bg-emerald-700">
                  <CreditCard className="w-4 h-4 mr-2" />
                  Print
                </Button>
              </div>
            </CardHeader>
            <CardContent className="p-8 flex justify-center">
              <div 
                ref={cardRef}
                className="w-[400px] h-[250px] bg-gradient-to-br from-emerald-600 to-emerald-800 rounded-2xl shadow-2xl p-6 text-white relative overflow-hidden"
              >
                {/* Background Pattern */}
                <div className="absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full -mr-20 -mt-20" />
                <div className="absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full -ml-16 -mb-16" />
                
                {/* Header */}
                <div className="relative z-10 flex flex-col h-full">
                  <div className="border-b border-white/30 pb-3 mb-4">
                    <p className="text-xs font-medium opacity-90">Jigawa State</p>
                    <p className="text-sm font-bold">Ministry of Livestock Development</p>
                  </div>

                  <div className="flex gap-4 flex-1">
                    {/* Photo Section */}
                    <div className="w-20 h-20 bg-white/20 rounded-lg flex items-center justify-center flex-shrink-0">
                      {selectedBeneficiary.user_photograph ? (
                        <img 
                          src={selectedBeneficiary.user_photograph} 
                          alt="Beneficiary" 
                          className="w-full h-full object-cover rounded-lg"
                        />
                      ) : (
                        <User className="w-10 h-10" />
                      )}
                    </div>

                    {/* Details */}
                    <div className="flex-1 space-y-2">
                      <div>
                        <p className="text-xs opacity-75">Name</p>
                        <p className="font-bold text-sm">{selectedBeneficiary.farmer_name}</p>
                      </div>
                      <div>
                        <p className="text-xs opacity-75">Reg ID</p>
                        <p className="font-mono font-bold text-xs">{selectedBeneficiary.registration_id}</p>
                      </div>
                      <div className="flex gap-4 text-xs">
                        <div>
                          <p className="opacity-75 flex items-center gap-1">
                            <Phone className="w-3 h-3" />
                            Phone
                          </p>
                          <p className="font-medium">{selectedBeneficiary.contact_number || 'N/A'}</p>
                        </div>
                      </div>
                    </div>
                  </div>

                  {/* Footer */}
                  <div className="pt-3 border-t border-white/30">
                    <div className="flex items-center justify-between text-xs">
                      <div className="flex items-center gap-1">
                        <MapPin className="w-3 h-3" />
                        <span>{selectedBeneficiary.ward}, {selectedBeneficiary.lga}</span>
                      </div>
                      <span className="opacity-75">Valid ID</span>
                    </div>
                  </div>
                </div>
              </div>
            </CardContent>
          </Card>
        </>
      )}

      {!selectedBeneficiary && (
        <Card className="border-dashed">
          <CardContent className="p-12 text-center">
            <CreditCard className="w-16 h-16 text-slate-300 mx-auto mb-4" />
            <p className="text-slate-500">Search and select a beneficiary to generate their ID card</p>
          </CardContent>
        </Card>
      )}
    </div>
  );
}




mysubmisson



import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Search,
  Filter,
  CheckCircle2,
  AlertCircle,
  User,
  Phone,
  MapPin,
  Building,
  RefreshCw,
  FileText,
  ChevronDown,
  Wifi,
  WifiOff,
  Navigation
} from 'lucide-react';
import { format } from 'date-fns';
import { ASSOCIATIONS } from '@/components/data/lgaWardData';
import { useEffect } from 'react';

export default function MySubmissions() {
  const [searchTerm, setSearchTerm] = useState('');
  const [filterAssociation, setFilterAssociation] = useState('all');
  const [selectedSubmission, setSelectedSubmission] = useState(null);
  const [isOnline, setIsOnline] = useState(navigator.onLine);

  useEffect(() => {
    const handleOnline = () => setIsOnline(true);
    const handleOffline = () => setIsOnline(false);
    
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, []);

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: submissions = [], isLoading } = useQuery({
    queryKey: ['mySubmissions', user?.email],
    queryFn: () => base44.entities.LivestockSubmission.filter({ created_by: user?.email }, '-created_date'),
    enabled: !!user?.email,
  });

  // Get pending from localStorage
  const pendingSubmissions = JSON.parse(localStorage.getItem('pendingSubmissions') || '[]');

  const allSubmissions = [
    ...pendingSubmissions.map(p => ({ ...p, submission_status: 'pending' })),
    ...submissions
  ];

  const filteredSubmissions = allSubmissions.filter(sub => {
    const matchesSearch = 
      sub.farmer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      sub.contact_number?.includes(searchTerm);
    const matchesAssociation = filterAssociation === 'all' || sub.association === filterAssociation;
    return matchesSearch && matchesAssociation;
  });

  const syncedCount = submissions.filter(s => s.submission_status === 'synced').length;
  const pendingCount = pendingSubmissions.length;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-2xl font-bold text-slate-900">My Submissions</h1>
        <p className="text-slate-500 mt-1">View and manage all your data submissions</p>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-3xl font-bold text-slate-900">{allSubmissions.length}</p>
            <p className="text-slate-500 text-sm">Total</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-3xl font-bold text-emerald-600">{syncedCount}</p>
            <p className="text-slate-500 text-sm">Synced</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-3xl font-bold text-amber-600">{pendingCount}</p>
            <p className="text-slate-500 text-sm">Pending</p>
          </CardContent>
        </Card>
      </div>

      {/* Status Banner */}
      {!isOnline && (
        <Card className="bg-amber-50 border-amber-200">
          <CardContent className="p-4 flex items-center gap-3">
            <WifiOff className="w-5 h-5 text-amber-600" />
            <div>
              <p className="font-medium text-amber-900">Offline - Viewing cached data</p>
              <p className="text-sm text-amber-700">Some recent submissions may not appear until you're back online.</p>
            </div>
          </CardContent>
        </Card>
      )}

      {/* Filters */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
          <Input
            placeholder="Search by farmer name or phone..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="pl-10"
          />
        </div>
        <Select value={filterAssociation} onValueChange={setFilterAssociation}>
          <SelectTrigger className="w-full sm:w-60">
            <Filter className="w-4 h-4 mr-2 text-slate-400" />
            <SelectValue placeholder="Filter by association" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Associations</SelectItem>
            {ASSOCIATIONS.map((assoc) => (
              <SelectItem key={assoc} value={assoc}>{assoc}</SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      {/* Submissions List */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <FileText className="w-5 h-5 text-emerald-600" />
            Submissions ({filteredSubmissions.length})
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
              <p className="text-slate-500 mt-2">Loading submissions...</p>
            </div>
          ) : filteredSubmissions.length === 0 ? (
            <div className="p-8 text-center">
              <div className="w-16 h-16 mx-auto mb-4 bg-slate-100 rounded-full flex items-center justify-center">
                <FileText className="w-8 h-8 text-slate-400" />
              </div>
              <p className="text-slate-600 font-medium">No submissions found</p>
              <p className="text-slate-400 text-sm mt-1">
                {searchTerm || filterAssociation !== 'all' 
                  ? 'Try adjusting your filters'
                  : 'Start collecting data to see submissions here'}
              </p>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {filteredSubmissions.map((submission, index) => (
                <div 
                  key={submission.id || submission.offline_id || index}
                  className="p-4 hover:bg-slate-50 cursor-pointer transition-colors"
                  onClick={() => setSelectedSubmission(submission)}
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="font-semibold text-slate-900 truncate">
                          {submission.farmer_name}
                        </h3>
                        {submission.submission_status === 'synced' ? (
                          <Badge className="bg-emerald-100 text-emerald-700 text-xs">
                            <CheckCircle2 className="w-3 h-3 mr-1" /> Synced
                          </Badge>
                        ) : (
                          <Badge className="bg-amber-100 text-amber-700 text-xs">
                            <AlertCircle className="w-3 h-3 mr-1" /> Pending
                          </Badge>
                        )}
                      </div>
                      <p className="text-slate-600 text-sm">{submission.association}</p>
                      <div className="flex items-center gap-4 mt-2 text-slate-500 text-xs">
                        <span className="flex items-center gap-1">
                          <MapPin className="w-3 h-3" /> {submission.ward}, {submission.lga}
                        </span>
                        <span className="flex items-center gap-1">
                          <Phone className="w-3 h-3" /> {submission.contact_number}
                        </span>
                      </div>
                    </div>
                    <div className="text-right">
                      <Badge variant="outline" className="mb-2">
                        {submission.number_of_animals} animals
                      </Badge>
                      {submission.created_date && (
                        <p className="text-xs text-slate-400">
                          {format(new Date(submission.created_date), 'MMM d, yyyy')}
                        </p>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Detail Dialog */}
      <Dialog open={!!selectedSubmission} onOpenChange={() => setSelectedSubmission(null)}>
        <DialogContent className="max-w-md">
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <User className="w-5 h-5 text-emerald-600" />
              Submission Details
            </DialogTitle>
          </DialogHeader>
          {selectedSubmission && (
            <div className="space-y-4">
            {selectedSubmission.registration_id && (
              <div className="p-4 bg-emerald-50 border border-emerald-200 rounded-lg">
                <p className="text-emerald-700 text-xs font-medium mb-1">Registration ID</p>
                <p className="text-emerald-900 font-mono font-bold text-lg">{selectedSubmission.registration_id}</p>
              </div>
            )}

            <div className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
              <span className="text-slate-600">Status</span>
              {selectedSubmission.submission_status === 'synced' ? (
                <Badge className="bg-emerald-100 text-emerald-700">
                  <CheckCircle2 className="w-3 h-3 mr-1" /> Synced
                </Badge>
              ) : (
                <Badge className="bg-amber-100 text-amber-700">
                  <AlertCircle className="w-3 h-3 mr-1" /> Pending Sync
                </Badge>
              )}
            </div>

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <User className="w-4 h-4" /> Farmer Information
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">Name</p>
                    <p className="font-medium">{selectedSubmission.farmer_name}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Phone</p>
                    <p className="font-medium">{selectedSubmission.contact_number}</p>
                  </div>
                  {selectedSubmission.bvn && (
                    <div>
                      <p className="text-slate-500">BVN</p>
                      <p className="font-medium">{selectedSubmission.bvn}</p>
                    </div>
                  )}
                  {selectedSubmission.nin && (
                    <div>
                      <p className="text-slate-500">NIN</p>
                      <p className="font-medium">{selectedSubmission.nin}</p>
                    </div>
                  )}
                </div>
              </div>

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <MapPin className="w-4 h-4" /> Location
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">LGA</p>
                    <p className="font-medium">{selectedSubmission.lga}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Ward</p>
                    <p className="font-medium">{selectedSubmission.ward}</p>
                  </div>
                </div>
              </div>

              <div className="space-y-3">
                <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                  <Building className="w-4 h-4" /> Association
                </h4>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div>
                    <p className="text-slate-500">Type</p>
                    <p className="font-medium">{selectedSubmission.association}</p>
                  </div>
                  <div>
                    <p className="text-slate-500">Animals</p>
                    <p className="font-medium text-emerald-600 text-lg">{selectedSubmission.number_of_animals}</p>
                  </div>
                  {selectedSubmission.membership_status && (
                    <div>
                      <p className="text-slate-500">Membership</p>
                      <p className="font-medium capitalize">{selectedSubmission.membership_status.replace('_', ' ')}</p>
                    </div>
                  )}
                  {selectedSubmission.executive_position && (
                    <div>
                      <p className="text-slate-500">Position</p>
                      <p className="font-medium">{selectedSubmission.executive_position}</p>
                    </div>
                  )}
                </div>
              </div>

              {selectedSubmission.geo_location && (
                <div className="space-y-2">
                  <h4 className="font-semibold text-slate-900 flex items-center gap-2">
                    <Navigation className="w-4 h-4" /> GPS Coordinates
                  </h4>
                  <div className="bg-emerald-50 p-3 rounded-lg">
                    <p className="text-emerald-900 font-mono text-sm">{selectedSubmission.geo_location}</p>
                    <a 
                      href={`https://www.google.com/maps?q=${selectedSubmission.geo_location}`}
                      target="_blank"
                      rel="noopener noreferrer"
                      className="text-emerald-600 text-xs hover:underline mt-1 inline-block"
                    >
                      View on Google Maps 
                    </a>
                  </div>
                </div>
              )}

              {selectedSubmission.remarks && (
                <div className="space-y-2">
                  <h4 className="font-semibold text-slate-900">Remarks</h4>
                  <p className="text-slate-600 text-sm bg-slate-50 p-3 rounded-lg">
                    {selectedSubmission.remarks}
                  </p>
                </div>
              )}
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}



notification center



import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  Bell,
  Plus,
  RefreshCw,
  Send,
  Users,
  MapPin,
  User,
  Megaphone,
  CheckCircle
} from 'lucide-react';
import { format } from 'date-fns';
import { getLGAs, getWards } from '@/components/data/lgaWardData';
import { logAudit } from '@/components/utils/auditLogger';

export default function NotificationCenter() {
  const [showNewNotification, setShowNewNotification] = useState(false);
  const [newNotification, setNewNotification] = useState({
    title: '',
    message: '',
    target_type: 'all',
    target_lga: '',
    target_ward: '',
    target_agent_id: ''
  });

  const queryClient = useQueryClient();

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: () => base44.auth.me(),
  });

  const { data: notifications = [], isLoading } = useQuery({
    queryKey: ['notifications'],
    queryFn: () => base44.entities.Notification.list('-created_date'),
  });

  const { data: users = [] } = useQuery({
    queryKey: ['allUsers'],
    queryFn: () => base44.entities.User.list(),
  });

  const agents = users.filter(u => u.user_role === 'agent');

  const createNotificationMutation = useMutation({
    mutationFn: async (data) => {
      const result = await base44.entities.Notification.create(data);
      await logAudit(
        'notification_sent',
        'Notification',
        `Sent notification "${data.title}" to ${data.target_type}`,
        { entity_id: result.id, target_type: data.target_type, target_lga: data.target_lga, target_ward: data.target_ward }
      );
      return result;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['notifications'] });
      setShowNewNotification(false);
      setNewNotification({
        title: '',
        message: '',
        target_type: 'all',
        target_lga: '',
        target_ward: '',
        target_agent_id: ''
      });
    },
  });

  const handleSendNotification = () => {
    createNotificationMutation.mutate({
      ...newNotification,
      sent_by: user?.full_name
    });
  };

  const getTargetBadge = (notification) => {
    switch (notification.target_type) {
      case 'all':
        return <Badge className="bg-emerald-100 text-emerald-700"><Users className="w-3 h-3 mr-1" /> All Agents</Badge>;
      case 'lga':
        return <Badge className="bg-blue-100 text-blue-700"><MapPin className="w-3 h-3 mr-1" /> {notification.target_lga}</Badge>;
      case 'ward':
        return <Badge className="bg-purple-100 text-purple-700"><MapPin className="w-3 h-3 mr-1" /> {notification.target_ward}</Badge>;
      case 'individual':
        return <Badge className="bg-amber-100 text-amber-700"><User className="w-3 h-3 mr-1" /> Individual</Badge>;
      default:
        return <Badge>Unknown</Badge>;
    }
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
          <h1 className="text-2xl font-bold text-slate-900">Notification Center</h1>
          <p className="text-slate-500 mt-1">Send announcements to agents</p>
        </div>
        <Button 
          onClick={() => setShowNewNotification(true)}
          className="bg-emerald-600 hover:bg-emerald-700"
        >
          <Plus className="w-4 h-4 mr-2" />
          New Notification
        </Button>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-3 gap-4">
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-slate-900">{notifications.length}</p>
            <p className="text-slate-500 text-sm">Total Sent</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-emerald-600">
              {notifications.filter(n => n.target_type === 'all').length}
            </p>
            <p className="text-slate-500 text-sm">Broadcasts</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <p className="text-2xl font-bold text-blue-600">
              {notifications.filter(n => n.target_type !== 'all').length}
            </p>
            <p className="text-slate-500 text-sm">Targeted</p>
          </CardContent>
        </Card>
      </div>

      {/* Notifications List */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <Megaphone className="w-5 h-5 text-emerald-600" />
            Sent Notifications
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
            </div>
          ) : notifications.length === 0 ? (
            <div className="p-8 text-center">
              <Bell className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No notifications sent</p>
              <p className="text-slate-400 text-sm">Send your first notification to agents</p>
              <Button 
                onClick={() => setShowNewNotification(true)}
                className="mt-4 bg-emerald-600 hover:bg-emerald-700"
              >
                <Plus className="w-4 h-4 mr-2" />
                Send Notification
              </Button>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {notifications.map((notification) => (
                <div key={notification.id} className="p-4 hover:bg-slate-50 transition-colors">
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="font-semibold text-slate-900">
                          {notification.title}
                        </h3>
                        {getTargetBadge(notification)}
                      </div>
                      <p className="text-slate-600 text-sm">
                        {notification.message}
                      </p>
                      <p className="text-xs text-slate-400 mt-2">
                        Sent by {notification.sent_by || 'System'}  {notification.created_date && format(new Date(notification.created_date), 'PPp')}
                      </p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* New Notification Dialog */}
      <Dialog open={showNewNotification} onOpenChange={setShowNewNotification}>
        <DialogContent className="max-w-lg">
          <DialogHeader>
            <DialogTitle>Send Notification</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>Title *</Label>
              <Input
                placeholder="Notification title"
                value={newNotification.title}
                onChange={(e) => setNewNotification({ ...newNotification, title: e.target.value })}
              />
            </div>

            <div className="space-y-2">
              <Label>Target Audience</Label>
              <Select
                value={newNotification.target_type}
                onValueChange={(v) => setNewNotification({ 
                  ...newNotification, 
                  target_type: v,
                  target_lga: '',
                  target_ward: '',
                  target_agent_id: ''
                })}
              >
                <SelectTrigger>
                  <SelectValue />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="all">All Agents</SelectItem>
                  <SelectItem value="lga">Specific LGA</SelectItem>
                  <SelectItem value="ward">Specific Ward</SelectItem>
                  <SelectItem value="individual">Individual Agent</SelectItem>
                </SelectContent>
              </Select>
            </div>

            {newNotification.target_type === 'lga' && (
              <div className="space-y-2">
                <Label>Select LGA</Label>
                <Select
                  value={newNotification.target_lga}
                  onValueChange={(v) => setNewNotification({ ...newNotification, target_lga: v })}
                >
                  <SelectTrigger>
                    <SelectValue placeholder="Select LGA" />
                  </SelectTrigger>
                  <SelectContent>
                    {getLGAs().map((lga) => (
                      <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}

            {newNotification.target_type === 'ward' && (
              <>
                <div className="space-y-2">
                  <Label>Select LGA</Label>
                  <Select
                    value={newNotification.target_lga}
                    onValueChange={(v) => setNewNotification({ ...newNotification, target_lga: v, target_ward: '' })}
                  >
                    <SelectTrigger>
                      <SelectValue placeholder="Select LGA" />
                    </SelectTrigger>
                    <SelectContent>
                      {getLGAs().map((lga) => (
                        <SelectItem key={lga} value={lga}>{lga}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <Label>Select Ward</Label>
                  <Select
                    value={newNotification.target_ward}
                    onValueChange={(v) => setNewNotification({ ...newNotification, target_ward: v })}
                    disabled={!newNotification.target_lga}
                  >
                    <SelectTrigger>
                      <SelectValue placeholder="Select Ward" />
                    </SelectTrigger>
                    <SelectContent>
                      {newNotification.target_lga && getWards(newNotification.target_lga).map((ward) => (
                        <SelectItem key={ward} value={ward}>{ward}</SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
              </>
            )}

            {newNotification.target_type === 'individual' && (
              <div className="space-y-2">
                <Label>Select Agent</Label>
                <Select
                  value={newNotification.target_agent_id}
                  onValueChange={(v) => setNewNotification({ ...newNotification, target_agent_id: v })}
                >
                  <SelectTrigger>
                    <SelectValue placeholder="Select Agent" />
                  </SelectTrigger>
                  <SelectContent>
                    {agents.map((agent) => (
                      <SelectItem key={agent.id} value={agent.id}>
                        {agent.full_name} - {agent.assigned_ward || 'Unassigned'}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
              </div>
            )}

            <div className="space-y-2">
              <Label>Message *</Label>
              <Textarea
                placeholder="Enter your message..."
                value={newNotification.message}
                onChange={(e) => setNewNotification({ ...newNotification, message: e.target.value })}
                rows={4}
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowNewNotification(false)}>
              Cancel
            </Button>
            <Button
              onClick={handleSendNotification}
              disabled={!newNotification.title || !newNotification.message || createNotificationMutation.isPending}
              className="bg-emerald-600 hover:bg-emerald-700"
            >
              {createNotificationMutation.isPending ? (
                <RefreshCw className="w-4 h-4 animate-spin mr-2" />
              ) : (
                <Send className="w-4 h-4 mr-2" />
              )}
              Send Notification
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}


support dashboard


import React, { useState } from 'react';
import { base44 } from '@/api/base44Client';
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Badge } from '@/components/ui/badge';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  Tabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from '@/components/ui/tabs';
import {
  HelpCircle,
  Search,
  RefreshCw,
  Clock,
  CheckCircle2,
  AlertCircle,
  XCircle,
  User,
  MapPin,
  MessageSquare,
  ChevronRight
} from 'lucide-react';
import { format } from 'date-fns';
import { logAudit } from '@/components/utils/auditLogger';

export default function SupportDashboard() {
  const [selectedTicket, setSelectedTicket] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filterStatus, setFilterStatus] = useState('all');
  const [response, setResponse] = useState('');
  const [internalNotes, setInternalNotes] = useState('');

  const queryClient = useQueryClient();

  const { data: tickets = [], isLoading } = useQuery({
    queryKey: ['supportTickets'],
    queryFn: () => base44.entities.SupportTicket.list('-created_date'),
  });

  const updateTicketMutation = useMutation({
    mutationFn: async ({ id, data, subject }) => {
      const result = await base44.entities.SupportTicket.update(id, data);
      await logAudit(
        'ticket_updated',
        'SupportTicket',
        `Updated ticket "${subject}" - new status: ${data.status}`,
        { entity_id: id, new_status: data.status }
      );
      return result;
    },
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['supportTickets'] });
      setSelectedTicket(null);
      setResponse('');
      setInternalNotes('');
    },
  });

  const filteredTickets = tickets.filter(ticket => {
    const matchesSearch = 
      ticket.subject?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      ticket.agent_name?.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesStatus = filterStatus === 'all' || ticket.status === filterStatus;
    return matchesSearch && matchesStatus;
  });

  const getStatusBadge = (status) => {
    const styles = {
      open: 'bg-blue-100 text-blue-700',
      in_progress: 'bg-amber-100 text-amber-700',
      resolved: 'bg-emerald-100 text-emerald-700',
      closed: 'bg-slate-100 text-slate-600'
    };
    const icons = {
      open: AlertCircle,
      in_progress: Clock,
      resolved: CheckCircle2,
      closed: XCircle
    };
    const Icon = icons[status] || AlertCircle;
    return (
      <Badge className={`${styles[status] || styles.open} flex items-center gap-1`}>
        <Icon className="w-3 h-3" />
        {status?.replace('_', ' ')}
      </Badge>
    );
  };

  const getPriorityBadge = (priority) => {
    const styles = {
      low: 'bg-slate-100 text-slate-600',
      medium: 'bg-yellow-100 text-yellow-700',
      high: 'bg-red-100 text-red-700'
    };
    return <Badge className={styles[priority] || styles.medium}>{priority}</Badge>;
  };

  const handleUpdateStatus = (newStatus) => {
    updateTicketMutation.mutate({
      id: selectedTicket.id,
      data: { 
        status: newStatus,
        internal_notes: internalNotes || selectedTicket.internal_notes
      },
      subject: selectedTicket.subject
    });
  };

  const openCount = tickets.filter(t => t.status === 'open').length;
  const inProgressCount = tickets.filter(t => t.status === 'in_progress').length;
  const resolvedCount = tickets.filter(t => t.status === 'resolved').length;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-2xl font-bold text-slate-900">Support Dashboard</h1>
        <p className="text-slate-500 mt-1">Manage agent tickets and issues</p>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <Card 
          className={`cursor-pointer transition-all ${filterStatus === 'open' ? 'ring-2 ring-blue-500' : ''}`}
          onClick={() => setFilterStatus(filterStatus === 'open' ? 'all' : 'open')}
        >
          <CardContent className="p-4 text-center">
            <AlertCircle className="w-6 h-6 mx-auto text-blue-500 mb-2" />
            <p className="text-2xl font-bold text-slate-900">{openCount}</p>
            <p className="text-slate-500 text-sm">Open</p>
          </CardContent>
        </Card>
        <Card 
          className={`cursor-pointer transition-all ${filterStatus === 'in_progress' ? 'ring-2 ring-amber-500' : ''}`}
          onClick={() => setFilterStatus(filterStatus === 'in_progress' ? 'all' : 'in_progress')}
        >
          <CardContent className="p-4 text-center">
            <Clock className="w-6 h-6 mx-auto text-amber-500 mb-2" />
            <p className="text-2xl font-bold text-slate-900">{inProgressCount}</p>
            <p className="text-slate-500 text-sm">In Progress</p>
          </CardContent>
        </Card>
        <Card 
          className={`cursor-pointer transition-all ${filterStatus === 'resolved' ? 'ring-2 ring-emerald-500' : ''}`}
          onClick={() => setFilterStatus(filterStatus === 'resolved' ? 'all' : 'resolved')}
        >
          <CardContent className="p-4 text-center">
            <CheckCircle2 className="w-6 h-6 mx-auto text-emerald-500 mb-2" />
            <p className="text-2xl font-bold text-slate-900">{resolvedCount}</p>
            <p className="text-slate-500 text-sm">Resolved</p>
          </CardContent>
        </Card>
        <Card>
          <CardContent className="p-4 text-center">
            <HelpCircle className="w-6 h-6 mx-auto text-purple-500 mb-2" />
            <p className="text-2xl font-bold text-slate-900">{tickets.length}</p>
            <p className="text-slate-500 text-sm">Total Tickets</p>
          </CardContent>
        </Card>
      </div>

      {/* Search */}
      <div className="flex flex-col sm:flex-row gap-4">
        <div className="relative flex-1">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
          <Input
            placeholder="Search tickets..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="pl-10"
          />
        </div>
        <Select value={filterStatus} onValueChange={setFilterStatus}>
          <SelectTrigger className="w-full sm:w-40">
            <SelectValue placeholder="All Status" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Status</SelectItem>
            <SelectItem value="open">Open</SelectItem>
            <SelectItem value="in_progress">In Progress</SelectItem>
            <SelectItem value="resolved">Resolved</SelectItem>
            <SelectItem value="closed">Closed</SelectItem>
          </SelectContent>
        </Select>
      </div>

      {/* Tickets List */}
      <Card>
        <CardHeader className="border-b border-slate-100">
          <CardTitle className="text-lg flex items-center gap-2">
            <MessageSquare className="w-5 h-5 text-emerald-600" />
            Tickets ({filteredTickets.length})
          </CardTitle>
        </CardHeader>
        <CardContent className="p-0">
          {isLoading ? (
            <div className="p-8 text-center">
              <RefreshCw className="w-8 h-8 animate-spin mx-auto text-slate-400" />
            </div>
          ) : filteredTickets.length === 0 ? (
            <div className="p-8 text-center">
              <HelpCircle className="w-12 h-12 mx-auto text-slate-300 mb-4" />
              <p className="text-slate-600 font-medium">No tickets found</p>
              <p className="text-slate-400 text-sm">
                {searchTerm || filterStatus !== 'all' ? 'Try adjusting your filters' : 'No support tickets yet'}
              </p>
            </div>
          ) : (
            <div className="divide-y divide-slate-100">
              {filteredTickets.map((ticket) => (
                <div
                  key={ticket.id}
                  className="p-4 hover:bg-slate-50 cursor-pointer transition-colors"
                  onClick={() => setSelectedTicket(ticket)}
                >
                  <div className="flex items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2 mb-1">
                        <h3 className="font-semibold text-slate-900 truncate">
                          {ticket.subject}
                        </h3>
                        {getStatusBadge(ticket.status)}
                        {getPriorityBadge(ticket.priority)}
                      </div>
                      <p className="text-slate-600 text-sm line-clamp-1">
                        {ticket.description}
                      </p>
                      <div className="flex items-center gap-4 mt-2 text-slate-500 text-xs">
                        <span className="flex items-center gap-1">
                          <User className="w-3 h-3" /> {ticket.agent_name || 'Unknown'}
                        </span>
                        {ticket.agent_ward && (
                          <span className="flex items-center gap-1">
                            <MapPin className="w-3 h-3" /> {ticket.agent_ward}
                          </span>
                        )}
                      </div>
                    </div>
                    <div className="text-right">
                      <p className="text-xs text-slate-400">
                        {ticket.created_date && format(new Date(ticket.created_date), 'MMM d')}
                      </p>
                      <ChevronRight className="w-4 h-4 text-slate-400 mt-2 ml-auto" />
                    </div>
                  </div>
                </div>
              ))}
            </div>
          )}
        </CardContent>
      </Card>

      {/* Ticket Detail Dialog */}
      <Dialog open={!!selectedTicket} onOpenChange={() => setSelectedTicket(null)}>
        <DialogContent className="max-w-lg">
          <DialogHeader>
            <DialogTitle>Ticket Details</DialogTitle>
          </DialogHeader>
          {selectedTicket && (
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                {getStatusBadge(selectedTicket.status)}
                {getPriorityBadge(selectedTicket.priority)}
              </div>

              <div>
                <h3 className="font-semibold text-lg">{selectedTicket.subject}</h3>
                <div className="flex items-center gap-4 mt-1 text-slate-500 text-sm">
                  <span className="flex items-center gap-1">
                    <User className="w-4 h-4" /> {selectedTicket.agent_name}
                  </span>
                  {selectedTicket.agent_ward && (
                    <span className="flex items-center gap-1">
                      <MapPin className="w-4 h-4" /> {selectedTicket.agent_ward}, {selectedTicket.agent_lga}
                    </span>
                  )}
                </div>
              </div>

              <div className="p-3 bg-slate-50 rounded-lg">
                <p className="text-slate-700">{selectedTicket.description}</p>
              </div>

              <div className="space-y-2">
                <Label>Internal Notes</Label>
                <Textarea
                  placeholder="Add internal notes..."
                  value={internalNotes || selectedTicket.internal_notes || ''}
                  onChange={(e) => setInternalNotes(e.target.value)}
                  rows={3}
                />
              </div>

              <div className="space-y-2">
                <Label>Update Status</Label>
                <div className="grid grid-cols-2 gap-2">
                  <Button
                    variant="outline"
                    onClick={() => handleUpdateStatus('in_progress')}
                    disabled={selectedTicket.status === 'in_progress' || updateTicketMutation.isPending}
                    className="justify-start"
                  >
                    <Clock className="w-4 h-4 mr-2 text-amber-500" />
                    In Progress
                  </Button>
                  <Button
                    variant="outline"
                    onClick={() => handleUpdateStatus('resolved')}
                    disabled={selectedTicket.status === 'resolved' || updateTicketMutation.isPending}
                    className="justify-start"
                  >
                    <CheckCircle2 className="w-4 h-4 mr-2 text-emerald-500" />
                    Resolved
                  </Button>
                  <Button
                    variant="outline"
                    onClick={() => handleUpdateStatus('closed')}
                    disabled={selectedTicket.status === 'closed' || updateTicketMutation.isPending}
                    className="justify-start"
                  >
                    <XCircle className="w-4 h-4 mr-2 text-slate-500" />
                    Close
                  </Button>
                  <Button
                    variant="outline"
                    onClick={() => handleUpdateStatus('open')}
                    disabled={selectedTicket.status === 'open' || updateTicketMutation.isPending}
                    className="justify-start"
                  >
                    <AlertCircle className="w-4 h-4 mr-2 text-blue-500" />
                    Reopen
                  </Button>
                </div>
              </div>

              <div className="text-xs text-slate-400">
                Created: {selectedTicket.created_date && format(new Date(selectedTicket.created_date), 'PPp')}
              </div>
            </div>
          )}
        </DialogContent>
      </Dialog>
    </div>
  );
}


system config




import React, { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Badge } from '@/components/ui/badge';
import {
  Tabs,
  TabsContent,
  TabsList,
  TabsTrigger,
} from '@/components/ui/tabs';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogFooter,
} from '@/components/ui/dialog';
import {
  Settings,
  Building,
  MapPin,
  CreditCard,
  Users as UsersIcon,
  Plus,
  Edit,
  Trash2,
  Save
} from 'lucide-react';
import { LGA_WARD_DATA, ASSOCIATIONS, BANKS } from '@/components/data/lgaWardData';

export default function SystemConfig() {
  const [banks, setBanks] = useState(BANKS);
  const [associations, setAssociations] = useState(ASSOCIATIONS);
  const [lgaWardData, setLgaWardData] = useState(LGA_WARD_DATA);
  
  const [showBankDialog, setShowBankDialog] = useState(false);
  const [showAssocDialog, setShowAssocDialog] = useState(false);
  const [showWardDialog, setShowWardDialog] = useState(false);
  
  const [newBank, setNewBank] = useState('');
  const [newAssociation, setNewAssociation] = useState('');
  const [selectedLGA, setSelectedLGA] = useState('');
  const [newWard, setNewWard] = useState('');
  const [editingWard, setEditingWard] = useState('');

  const handleAddBank = () => {
    if (newBank.trim()) {
      setBanks([...banks, newBank.trim()].sort());
      setNewBank('');
      setShowBankDialog(false);
      alert('Bank added successfully! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  const handleRemoveBank = (bank) => {
    if (confirm(`Remove ${bank}?`)) {
      setBanks(banks.filter(b => b !== bank));
      alert('Bank removed! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  const handleAddAssociation = () => {
    if (newAssociation.trim()) {
      setAssociations([...associations, newAssociation.trim()]);
      setNewAssociation('');
      setShowAssocDialog(false);
      alert('Association added! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  const handleRemoveAssociation = (assoc) => {
    if (confirm(`Remove ${assoc}?`)) {
      setAssociations(associations.filter(a => a !== assoc));
      alert('Association removed! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  const handleAddWard = () => {
    if (selectedLGA && newWard.trim()) {
      const updatedData = {
        ...lgaWardData,
        [selectedLGA]: [...(lgaWardData[selectedLGA] || []), newWard.trim()].sort()
      };
      setLgaWardData(updatedData);
      setNewWard('');
      setShowWardDialog(false);
      alert('Ward added! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  const handleRemoveWard = (lga, ward) => {
    if (confirm(`Remove ${ward} from ${lga}?`)) {
      const updatedData = {
        ...lgaWardData,
        [lga]: lgaWardData[lga].filter(w => w !== ward)
      };
      setLgaWardData(updatedData);
      alert('Ward removed! Note: To persist this change, update the lgaWardData.js file.');
    }
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-2xl font-bold text-slate-900">System Configuration</h1>
        <p className="text-slate-500 mt-1">Manage form data and system settings</p>
      </div>

      {/* Warning Banner */}
      <Card className="bg-amber-50 border-amber-200">
        <CardContent className="p-4">
          <p className="text-amber-900 text-sm">
            <strong>Note:</strong> Changes made here are temporary. To persist changes permanently, 
            update the <code className="bg-amber-100 px-1 rounded">components/data/lgaWardData.js</code> file.
          </p>
        </CardContent>
      </Card>

      <Tabs defaultValue="banks" className="w-full">
        <TabsList className="grid w-full grid-cols-3">
          <TabsTrigger value="banks">
            <CreditCard className="w-4 h-4 mr-2" />
            Banks
          </TabsTrigger>
          <TabsTrigger value="associations">
            <UsersIcon className="w-4 h-4 mr-2" />
            Associations
          </TabsTrigger>
          <TabsTrigger value="wards">
            <MapPin className="w-4 h-4 mr-2" />
            LGA/Wards
          </TabsTrigger>
        </TabsList>

        {/* Banks Tab */}
        <TabsContent value="banks">
          <Card>
            <CardHeader className="border-b border-slate-100">
              <div className="flex items-center justify-between">
                <CardTitle className="text-lg flex items-center gap-2">
                  <CreditCard className="w-5 h-5 text-emerald-600" />
                  Banks ({banks.length})
                </CardTitle>
                <Button 
                  size="sm" 
                  onClick={() => setShowBankDialog(true)}
                  className="bg-emerald-600 hover:bg-emerald-700"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Bank
                </Button>
              </div>
            </CardHeader>
            <CardContent className="p-6">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                {banks.map((bank) => (
                  <div key={bank} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                    <span className="text-slate-700">{bank}</span>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleRemoveBank(bank)}
                      className="text-red-600 hover:text-red-700"
                    >
                      <Trash2 className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        {/* Associations Tab */}
        <TabsContent value="associations">
          <Card>
            <CardHeader className="border-b border-slate-100">
              <div className="flex items-center justify-between">
                <CardTitle className="text-lg flex items-center gap-2">
                  <UsersIcon className="w-5 h-5 text-emerald-600" />
                  Associations ({associations.length})
                </CardTitle>
                <Button 
                  size="sm" 
                  onClick={() => setShowAssocDialog(true)}
                  className="bg-emerald-600 hover:bg-emerald-700"
                >
                  <Plus className="w-4 h-4 mr-2" />
                  Add Association
                </Button>
              </div>
            </CardHeader>
            <CardContent className="p-6">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                {associations.map((assoc) => (
                  <div key={assoc} className="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
                    <span className="text-slate-700">{assoc}</span>
                    <Button
                      variant="ghost"
                      size="sm"
                      onClick={() => handleRemoveAssociation(assoc)}
                      className="text-red-600 hover:text-red-700"
                    >
                      <Trash2 className="w-4 h-4" />
                    </Button>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>

        {/* LGA/Wards Tab */}
        <TabsContent value="wards">
          <Card>
            <CardHeader className="border-b border-slate-100">
              <CardTitle className="text-lg flex items-center gap-2">
                <MapPin className="w-5 h-5 text-emerald-600" />
                LGA & Ward Mappings
              </CardTitle>
            </CardHeader>
            <CardContent className="p-6">
              <div className="space-y-6">
                {Object.keys(lgaWardData).sort().map((lga) => (
                  <div key={lga} className="border border-slate-200 rounded-lg p-4">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="font-semibold text-slate-900">{lga}</h3>
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => {
                          setSelectedLGA(lga);
                          setShowWardDialog(true);
                        }}
                      >
                        <Plus className="w-4 h-4 mr-2" />
                        Add Ward
                      </Button>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {lgaWardData[lga].map((ward) => (
                        <Badge
                          key={ward}
                          variant="outline"
                          className="flex items-center gap-2"
                        >
                          {ward}
                          <button
                            onClick={() => handleRemoveWard(lga, ward)}
                            className="text-red-600 hover:text-red-700"
                          >
                            <Trash2 className="w-3 h-3" />
                          </button>
                        </Badge>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </TabsContent>
      </Tabs>

      {/* Add Bank Dialog */}
      <Dialog open={showBankDialog} onOpenChange={setShowBankDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Add New Bank</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>Bank Name</Label>
              <Input
                value={newBank}
                onChange={(e) => setNewBank(e.target.value)}
                placeholder="Enter bank name"
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowBankDialog(false)}>
              Cancel
            </Button>
            <Button onClick={handleAddBank} className="bg-emerald-600 hover:bg-emerald-700">
              Add Bank
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Add Association Dialog */}
      <Dialog open={showAssocDialog} onOpenChange={setShowAssocDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Add New Association</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>Association Name</Label>
              <Input
                value={newAssociation}
                onChange={(e) => setNewAssociation(e.target.value)}
                placeholder="Enter association name"
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowAssocDialog(false)}>
              Cancel
            </Button>
            <Button onClick={handleAddAssociation} className="bg-emerald-600 hover:bg-emerald-700">
              Add Association
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Add Ward Dialog */}
      <Dialog open={showWardDialog} onOpenChange={setShowWardDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Add Ward to {selectedLGA}</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="space-y-2">
              <Label>Ward Name</Label>
              <Input
                value={newWard}
                onChange={(e) => setNewWard(e.target.value)}
                placeholder="Enter ward name"
              />
            </div>
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowWardDialog(false)}>
              Cancel
            </Button>
            <Button onClick={handleAddWard} className="bg-emerald-600 hover:bg-emerald-700">
              Add Ward
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}



usermanagement




all above are pages/


now componet/


import React from 'react';

const UserNotRegisteredError = () => {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gradient-to-b from-white to-slate-50">
      <div className="max-w-md w-full p-8 bg-white rounded-lg shadow-lg border border-slate-100">
        <div className="text-center">
          <div className="inline-flex items-center justify-center w-16 h-16 mb-6 rounded-full bg-orange-100">
            <svg className="w-8 h-8 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <h1 className="text-3xl font-bold text-slate-900 mb-4">Access Restricted</h1>
          <p className="text-slate-600 mb-8">
            You are not registered to use this application. Please contact the app administrator to request access.
          </p>
          <div className="p-4 bg-slate-50 rounded-md text-sm text-slate-600">
            <p>If you believe this is an error, you can:</p>
            <ul className="list-disc list-inside mt-2 space-y-1">
              <li>Verify you are logged in with the correct account</li>
              <li>Contact the app administrator for access</li>
              <li>Try logging out and back in again</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  );
};

export default UserNotRegisteredError;



then the ui component


data/lgaWardData.js


// Jigawa State LGAs and their Wards
export const LGA_WARD_DATA = {
  "Auyo": ["Abalago", "Auyakayi", "Auyo", "Ayama", "Gamafoi", "Gamsarka", "Gatafa", "Kafin Hausa", "Kara", "Tsidir"],
  "Babura": ["Babura", "Batali", "Dorawa", "Galagamma", "Garbagal", "Insharuwa", "Jigawa", "Kanya", "Kikai", "Kyambo", "Takwasa"],
  "Biriniwa": ["Batu", "Birniwa A", "Birniwa B", "Dangwaleri", "Diginsa", "Fagi", "Kachallari", "Kanya", "Karanka", "Machumurza", "Nguwa"],
  "Birnin Kudu": ["Birnin Kudu A", "Birnin Kudu B", "Birnin Kudu C", "Kangire", "Kiyawa", "Kwangwara", "Lafiya", "Sundimina", "Unguwar Jarmai", "Wurno", "Yalawa"],
  "Buji": ["Ahoto", "Buji", "Gantsa", "Gargari", "K/Bai", "Kawaya", "Kukuma", "Madabe", "Maje", "Yanduna"],
  "Dutse": ["Chamo", "Dundubus", "Karnaya", "Kiyawa", "Kudai", "Limawa", "Madobi", "Sakwaya", "Takur", "Yalleman"],
  "Gagarawa": ["Gagarawa", "Gala", "Gamoji", "Kadira", "Madachi", "Maikilili", "Marma", "Miko", "Ringim", "Yola"],
  "Garki": ["Buduru", "Dabuwaran", "Doko", "Garki", "Jirima", "Kanya", "Karare", "Kore", "Mabaya", "Sansani"],
  "Gumel": ["Danama", "Gadigawa", "Gantsa", "Gumel A", "Gumel B", "Hammayo", "Madori", "Maira", "Yola"],
  "Guri": ["Abaya", "Adiyani", "Dagwaje", "Dawa", "Guri", "Kafinmadiga", "Kadafawa", "Lafiya", "Miga", "Zubar"],
  "Gwaram": ["Basirka", "Dingale", "Fagam", "Gwaram A", "Gwaram B", "Jigawa", "Kiri", "Kukuma", "Runni", "Sunkuntu"],
  "Gwiwa": ["Dan Alkima", "Gwiwa", "Hanafari", "Illela", "Jigawa", "Kara", "Karoki", "Kawaya", "Saya-Saya", "Suntulma"],
  "Hadejia": ["Atafi", "Gagulmari", "Kasuwar Kofa", "Majema", "Matsaro", "Rumfa", "Sabon Gari", "Yayari"],
  "Jahun": ["Aujara", "Gafaya", "Gangawa", "Gunka", "Harbo", "Idalo", "Jahun", "Kale", "Kanwa", "Karkarna"],
  "Kafin Hausa": ["Bela", "Dubantu", "Gafaya", "Gwarzon Kunya", "Jabo", "Kafin Hausa", "Kazura", "Majiya", "Mechi", "Rumfa", "Zago"],
  "Kaugama": ["Arbus", "Dagwaje", "Dakayyawa", "Garin Gabas", "Jeke", "Karanka", "Kaugama", "Marina", "Marke", "Zabaro"],
  "Kazaure": ["Daba", "Dandi", "Gada", "Jani", "Kazaure A", "Kazaure B", "Sabaru", "Unguwar Idi", "Yankwani", "Yola"],
  "Kiri Kasamma": ["Balarabe", "Batarawa", "Dan Darman", "Faida", "K/Madiga", "K/Sama A", "K/Sama B", "Marma", "Nasarawar Kuki", "Zabau"],
  "Kiyawa": ["Andaza", "Farin Ruwa", "Garko", "Katanga", "Kiyawa", "Kwanda", "Maje", "Shuwaki", "Tsurma", "Yola"],
  "Maigatari": ["Balarabe", "Dala", "Dankumbo", "Galadi", "Jigawa", "Maigatari A", "Maigatari B", "Marke", "Matoya", "Turbus"],
  "Malam Madori": ["Bulunchai", "Dabi", "Gwaram", "M/Madori A", "M/Madori B", "Mufara", "Sadu Kanti", "Santuraki", "Yalo", "Zanbau"],
  "Miga": ["Dangyatin", "Garbo", "Hadin", "Jigawa", "Margadu", "Miga", "Sabon Gari Takanebu", "Sansani", "Takatsaba", "Yandamo"],
  "Ringim": ["Chai Chai", "Dabi", "Dunari", "Kafin Babushe", "Karshi", "Kwa", "Kyarama", "Ringim A", "Ringim B", "Sankara", "Tofa"],
  "Roni": ["Amaryawa", "Dan Gawo", "Gora", "Gwarzo", "Kiyawa", "Roni A", "Roni B", "Tonikutara", "Yanzaki", "Zugai"],
  "Sule Tankarkar": ["Albasu", "Amanga", "Dan-Kawa", "Jabarna", "Jarkasa", "Maizuwo", "Marke", "S/Tankarkar A", "S/Tankarkar B", "Yalawa"],
  "Taura": ["Abalago", "Akarambe", "Chakwaikwai", "Giwa", "Kwanda", "Maje", "Majiya", "Shabaru", "Taura", "Tungar Mairuwa"],
  "Yankwashi": ["Belas", "Dan Masara", "Danzomo", "Dosan Kaya", "Garki", "Gwaita", "Karkarna", "Shafe", "Turawa", "Yankwashi"]
};

export const ASSOCIATIONS = [
  "Sheep and Goat",
  "Rabbit Association (Zomo)",
  "Poultry Association",
  "Mata Masu Saida Nono",
  "Kungiyar Masu Kiwon Tattabara",
  "Kungiyar Masu Saida Kifi",
  "Kungiyar Masu Kiwon Kifi",
  "Kungiyar Masu Gasa Kifi",
  "Kungiyar Masu Kiwon Zuma",
  "Dillalan Dabbobi",
  "Kungiyar Masu Maganin Dabbobi",
  "Kungiyar Masu Saida Fata",
  "Kungiyar Masu Kiwon Agwagi",
  "Kungiyar Masu Kai Dabbobi Kudu",
  "Kungiyar Masu Safarar Dabbobi",
  "Kungiyar Masu Saida Abincin Dabbobi",
  "Kungiyar Mahauta",
  "Kungiyar Masu Kiwon Zabuwa",
  "Kungiyar Masu Saida Kwai",
  "Kungiyar Masu Saida Kaji",
  "Kungiyar Mafarauta"
];

export const BANKS = [
  "Access Bank",
  "Citibank Nigeria",
  "Ecobank Nigeria",
  "Fidelity Bank",
  "First Bank of Nigeria",
  "First City Monument Bank",
  "Globus Bank",
  "Guaranty Trust Bank",
  "Heritage Bank",
  "Jaiz Bank",
  "Keystone Bank",
  "Kuda Bank",
  "Opay",
  "Palmpay",
  "Polaris Bank",
  "Providus Bank",
  "Stanbic IBTC Bank",
  "Standard Chartered Bank",
  "Sterling Bank",
  "SunTrust Bank",
  "Titan Trust Bank",
  "Union Bank of Nigeria",
  "United Bank for Africa",
  "Unity Bank",
  "Wema Bank",
  "Zenith Bank"
];

export const getLGAs = () => Object.keys(LGA_WARD_DATA).sort();
export const getWards = (lga) => LGA_WARD_DATA[lga]?.sort() || [];



entities

livestocksubmission


{
  "name": "LivestockSubmission",
  "type": "object",
  "properties": {
    "registration_id": {
      "type": "string",
      "description": "Unique registration ID for the farmer"
    },
    "farmer_name": {
      "type": "string",
      "description": "Name of the farmer"
    },
    "contact_number": {
      "type": "string",
      "description": "Farmer contact number"
    },
    "user_photograph": {
      "type": "string",
      "description": "URL of user's photograph"
    },
    "bvn": {
      "type": "string",
      "description": "Bank Verification Number"
    },
    "nin": {
      "type": "string",
      "description": "National Identification Number"
    },
    "vin": {
      "type": "string",
      "description": "Voter Identification Number"
    },
    "account_number": {
      "type": "string",
      "description": "Bank account number"
    },
    "bank": {
      "type": "string",
      "description": "Bank name"
    },
    "account_name": {
      "type": "string",
      "description": "Account holder name"
    },
    "lga": {
      "type": "string",
      "description": "Local Government Area"
    },
    "ward": {
      "type": "string",
      "description": "Ward name"
    },
    "association": {
      "type": "string",
      "enum": [
        "Sheep and Goat",
        "Rabbit Association (Zomo)",
        "Poultry Association",
        "Mata Masu Saida Nono",
        "Kungiyar Masu Kiwon Tattabara",
        "Kungiyar Masu Saida Kifi",
        "Kungiyar Masu Kiwon Kifi",
        "Kungiyar Masu Gasa Kifi",
        "Kungiyar Masu Kiwon Zuma",
        "Dillalan Dabbobi",
        "Kungiyar Masu Maganin Dabbobi",
        "Kungiyar Masu Saida Fata",
        "Kungiyar Masu Kiwon Agwagi",
        "Kungiyar Masu Kai Dabbobi Kudu",
        "Kungiyar Masu Safarar Dabbobi",
        "Kungiyar Masu Saida Abincin Dabbobi",
        "Kungiyar Mahauta",
        "Kungiyar Masu Kiwon Zabuwa",
        "Kungiyar Masu Saida Kwai",
        "Kungiyar Masu Saida Kaji",
        "Kungiyar Mafarauta"
      ],
      "description": "Livestock association type"
    },
    "membership_status": {
      "type": "string",
      "enum": [
        "ordinary_member",
        "executive_member"
      ],
      "default": "ordinary_member",
      "description": "Membership status in the association"
    },
    "executive_position": {
      "type": "string",
      "description": "Position/title if executive member"
    },
    "number_of_animals": {
      "type": "number",
      "description": "Number of animals owned"
    },
    "has_disease": {
      "type": "boolean",
      "default": false,
      "description": "Whether livestock has disease"
    },
    "disease_name": {
      "type": "string",
      "description": "Name of the disease"
    },
    "disease_description": {
      "type": "string",
      "description": "Description of the disease"
    },
    "remarks": {
      "type": "string",
      "description": "Additional remarks"
    },
    "submission_status": {
      "type": "string",
      "enum": [
        "synced",
        "pending"
      ],
      "default": "synced"
    },
    "agent_id": {
      "type": "string",
      "description": "ID of the agent who submitted"
    },
    "agent_name": {
      "type": "string",
      "description": "Name of the agent"
    },
    "geo_location": {
      "type": "string",
      "description": "GPS coordinates"
    }
  },
  "required": [
    "farmer_name",
    "lga",
    "ward",
    "association",
    "number_of_animals"
  ],
  "rls": {
    "create": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin"
              ]
            }
          }
        },
        {
          "$and": [
            {
              "user_condition": {
                "user_role": "support_officer"
              }
            },
            {
              "lga": "{{user.assigned_lga}}"
            },
            {
              "ward": "{{user.assigned_ward}}"
            }
          ]
        }
      ]
    },
    "read": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin"
              ]
            }
          }
        },
        {
          "$and": [
            {
              "user_condition": {
                "user_role": "support_officer"
              }
            },
            {
              "lga": "{{user.assigned_lga}}"
            },
            {
              "ward": "{{user.assigned_ward}}"
            }
          ]
        }
      ]
    },
    "update": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin"
              ]
            }
          }
        },
        {
          "$and": [
            {
              "user_condition": {
                "user_role": "support_officer"
              }
            },
            {
              "lga": "{{user.assigned_lga}}"
            },
            {
              "ward": "{{user.assigned_ward}}"
            }
          ]
        }
      ]
    },
    "delete": {
      "user_condition": {
        "user_role": {
          "$in": [
            "admin",
            "super_admin"
          ]
        }
      }
    }
  }
}



support ticket


{
  "name": "SupportTicket",
  "type": "object",
  "properties": {
    "agent_id": {
      "type": "string",
      "description": "ID of the agent who created the ticket"
    },
    "agent_name": {
      "type": "string"
    },
    "agent_ward": {
      "type": "string"
    },
    "agent_lga": {
      "type": "string"
    },
    "subject": {
      "type": "string",
      "description": "Ticket subject"
    },
    "description": {
      "type": "string",
      "description": "Issue description"
    },
    "category": {
      "type": "string",
      "enum": [
        "technical",
        "data_issue",
        "account",
        "sync_problem",
        "other"
      ],
      "default": "other"
    },
    "status": {
      "type": "string",
      "enum": [
        "open",
        "in_progress",
        "resolved",
        "closed"
      ],
      "default": "open"
    },
    "priority": {
      "type": "string",
      "enum": [
        "low",
        "medium",
        "high"
      ],
      "default": "medium"
    },
    "internal_notes": {
      "type": "string",
      "description": "Internal support notes"
    },
    "assigned_to": {
      "type": "string",
      "description": "Support officer assigned"
    }
  },
  "required": [
    "subject",
    "description"
  ],
  "rls": {
    "create": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin",
                "support_officer"
              ]
            }
          }
        }
      ]
    },
    "read": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin"
              ]
            }
          }
        },
        {
          "$and": [
            {
              "user_condition": {
                "user_role": "support_officer"
              }
            },
            {
              "agent_lga": "{{user.assigned_lga}}"
            },
            {
              "agent_ward": "{{user.assigned_ward}}"
            }
          ]
        }
      ]
    },
    "update": {
      "$or": [
        {
          "created_by": "{{user.email}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin"
              ]
            }
          }
        },
        {
          "$and": [
            {
              "user_condition": {
                "user_role": "support_officer"
              }
            },
            {
              "agent_lga": "{{user.assigned_lga}}"
            },
            {
              "agent_ward": "{{user.assigned_ward}}"
            }
          ]
        }
      ]
    },
    "delete": {
      "user_condition": {
        "user_role": {
          "$in": [
            "admin",
            "super_admin"
          ]
        }
      }
    }
  }
}


notification


{
  "name": "Notification",
  "type": "object",
  "properties": {
    "title": {
      "type": "string"
    },
    "message": {
      "type": "string"
    },
    "target_type": {
      "type": "string",
      "enum": [
        "all",
        "lga",
        "ward",
        "individual"
      ],
      "default": "all"
    },
    "target_lga": {
      "type": "string",
      "description": "Target LGA if target_type is lga"
    },
    "target_ward": {
      "type": "string",
      "description": "Target ward if target_type is ward"
    },
    "target_agent_id": {
      "type": "string",
      "description": "Target agent ID if target_type is individual"
    },
    "sent_by": {
      "type": "string"
    },
    "is_read": {
      "type": "boolean",
      "default": false
    }
  },
  "required": [
    "title",
    "message"
  ],
  "rls": {
    "create": {
      "user_condition": {
        "user_role": {
          "$in": [
            "admin",
            "super_admin",
            "support_officer"
          ]
        }
      }
    },
    "read": {
      "$or": [
        {
          "target_type": "all"
        },
        {
          "target_type": "lga",
          "target_lga": "{{user.assigned_lga}}"
        },
        {
          "target_type": "ward",
          "target_ward": "{{user.assigned_ward}}"
        },
        {
          "target_type": "individual",
          "target_agent_id": "{{user.id}}"
        },
        {
          "user_condition": {
            "user_role": {
              "$in": [
                "admin",
                "super_admin",
                "support_officer"
              ]
            }
          }
        }
      ]
    },
    "update": {
      "user_condition": {
        "user_role": {
          "$in": [
            "admin",
            "super_admin",
            "support_officer"
          ]
        }
      }
    },
    "delete": {
      "user_condition": {
        "user_role": {
          "$in": [
            "admin",
            "super_admin"
          ]
        }
      }
    }
  }
}


distrubution


layout.js


import React, { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { createPageUrl } from './utils';
import { base44 } from '@/api/base44Client';
import { useQuery } from '@tanstack/react-query';
import {
  Home,
  FileText,
  Users,
  BarChart3,
  Settings,
  HelpCircle,
  Bell,
  Menu,
  X,
  LogOut,
  ChevronRight,
  Building2,
  ClipboardList,
  Package,
  MessageSquare,
  CreditCard
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Avatar, AvatarFallback } from '@/components/ui/avatar';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';

export default function Layout({ children, currentPageName }) {
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  const { data: user } = useQuery({
    queryKey: ['currentUser'],
    queryFn: async () => {
      const authenticated = await base44.auth.isAuthenticated();
      setIsAuthenticated(authenticated);
      if (authenticated) {
        return await base44.auth.me();
      }
      return null;
    },
  });

  const userRole = user?.user_role || 'agent';

  const getNavItems = () => {
    const baseItems = [];
    
    if (userRole === 'super_admin' || userRole === 'admin') {
      baseItems.push(
        { name: 'Dashboard', icon: BarChart3, page: 'AdminDashboard' },
        { name: 'Submissions', icon: ClipboardList, page: 'DataManagement' },
        { name: 'User Management', icon: Users, page: 'UserManagement' },
        { name: 'Distribution', icon: Package, page: 'DistributionManagement' },
        { name: 'Bulk SMS', icon: MessageSquare, page: 'BulkSMS' },
        { name: 'System Config', icon: Settings, page: 'SystemConfig' },
        { name: 'Support', icon: HelpCircle, page: 'SupportDashboard' },
        { name: 'Notifications', icon: Bell, page: 'NotificationCenter' },
        { name: 'Audit Logs', icon: Settings, page: 'AuditLogs' }
      );
    } else if (userRole === 'support_officer') {
      baseItems.push(
        { name: 'Support', icon: HelpCircle, page: 'SupportDashboard' },
        { name: 'Notifications', icon: Bell, page: 'NotificationCenter' }
      );
    } else {
      baseItems.push(
        { name: 'Dashboard', icon: Home, page: 'AgentDashboard' },
        { name: 'New Submission', icon: FileText, page: 'DataCollection' },
        { name: 'My Submissions', icon: ClipboardList, page: 'MySubmissions' },
        { name: 'Distribution', icon: Package, page: 'DistributionTracking' },
        { name: 'ID Card', icon: CreditCard, page: 'IDCardGenerator' },
        { name: 'Support', icon: HelpCircle, page: 'AgentSupport' },
        { name: 'Notifications', icon: Bell, page: 'AgentNotifications' }
      );
    }
    
    return baseItems;
  };

  const navItems = getNavItems();

  // Public pages don't need layout
  if (currentPageName === 'Home' || currentPageName === 'Landing') {
    return <>{children}</>;
  }

  if (!isAuthenticated) {
    return <>{children}</>;
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-emerald-50/30">
      {/* Mobile Header */}
      <header className="lg:hidden fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-xl border-b border-slate-200/60 px-4 py-3">
        <div className="flex items-center justify-between">
          <Button
            variant="ghost"
            size="icon"
            onClick={() => setSidebarOpen(true)}
            className="text-slate-600"
          >
            <Menu className="w-5 h-5" />
          </Button>
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-lg flex items-center justify-center">
              <Building2 className="w-4 h-4 text-white" />
            </div>
            <span className="font-bold text-slate-800 text-xs">Ministry of Livestock</span>
          </div>
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button variant="ghost" size="icon" className="rounded-full">
                <Avatar className="w-8 h-8">
                  <AvatarFallback className="bg-emerald-100 text-emerald-700 text-xs">
                    {user?.full_name?.charAt(0) || 'U'}
                  </AvatarFallback>
                </Avatar>
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent align="end" className="w-56">
              <div className="px-3 py-2">
                <p className="font-medium text-sm">{user?.full_name}</p>
                <p className="text-xs text-slate-500 capitalize">{userRole.replace('_', ' ')}</p>
              </div>
              <DropdownMenuSeparator />
              <DropdownMenuItem onClick={() => base44.auth.logout()}>
                <LogOut className="w-4 h-4 mr-2" />
                Logout
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </header>

      {/* Mobile Sidebar Overlay */}
      {sidebarOpen && (
        <div 
          className="lg:hidden fixed inset-0 bg-black/20 backdrop-blur-sm z-50"
          onClick={() => setSidebarOpen(false)}
        />
      )}

      {/* Sidebar */}
      <aside className={`
        fixed top-0 left-0 h-full w-72 bg-white border-r border-slate-200/60 z-50
        transform transition-transform duration-300 ease-out
        lg:translate-x-0
        ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
      `}>
        <div className="flex flex-col h-full">
          {/* Logo */}
          <div className="p-6 border-b border-slate-100">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20">
                  <Building2 className="w-5 h-5 text-white" />
                </div>
                <div>
                  <h1 className="font-bold text-slate-800 text-xs leading-tight">Ministry of Livestock</h1>
                  <p className="text-[10px] text-slate-500 leading-tight">Jigawa State</p>
                </div>
              </div>
              <Button
                variant="ghost"
                size="icon"
                onClick={() => setSidebarOpen(false)}
                className="lg:hidden"
              >
                <X className="w-5 h-5" />
              </Button>
            </div>
          </div>

          {/* Navigation */}
          <nav className="flex-1 p-4 space-y-1 overflow-y-auto">
            {navItems.map((item) => {
              const isActive = currentPageName === item.page;
              return (
                <Link
                  key={item.page}
                  to={createPageUrl(item.page)}
                  onClick={() => setSidebarOpen(false)}
                  className={`
                    flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200
                    ${isActive 
                      ? 'bg-emerald-50 text-emerald-700 shadow-sm' 
                      : 'text-slate-600 hover:bg-slate-50 hover:text-slate-800'
                    }
                  `}
                >
                  <item.icon className={`w-5 h-5 ${isActive ? 'text-emerald-600' : ''}`} />
                  <span className="font-medium text-sm">{item.name}</span>
                  {isActive && <ChevronRight className="w-4 h-4 ml-auto text-emerald-400" />}
                </Link>
              );
            })}
          </nav>

          {/* User Section */}
          <div className="p-4 border-t border-slate-100">
            <div className="flex items-center gap-3 p-3 rounded-xl bg-slate-50">
              <Avatar className="w-10 h-10">
                <AvatarFallback className="bg-emerald-100 text-emerald-700">
                  {user?.full_name?.charAt(0) || 'U'}
                </AvatarFallback>
              </Avatar>
              <div className="flex-1 min-w-0">
                <p className="font-medium text-sm text-slate-800 truncate">{user?.full_name}</p>
                <p className="text-xs text-slate-500 capitalize">{userRole.replace('_', ' ')}</p>
              </div>
              <Button
                variant="ghost"
                size="icon"
                onClick={() => base44.auth.logout()}
                className="text-slate-400 hover:text-red-500"
              >
                <LogOut className="w-4 h-4" />
              </Button>
            </div>
          </div>
        </div>
      </aside>

      {/* Main Content */}
      <main className="lg:pl-72 pt-16 lg:pt-0 min-h-screen">
        <div className="p-4 lg:p-8">
          {children}
        </div>
      </main>
    </div>
  );
}